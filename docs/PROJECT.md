# 🏥 헬스 히어로 (Health Hero)

**장르**: 교육형 퀴즈 RPG (모바일 웹/PWA, HTML5 기반)  
**목표**: 잘못된 민간요법과 의료 미신을 바로잡고, 생활·응급 의료지식을 재미있게 학습하도록 유도하는 퀴즈형 게임

---

## 📋 목차

1. [게임 핵심 컨셉](#게임-핵심-컨셉)
2. [핵심 플레이 루프](#핵심-플레이-루프)
3. [화면 구성](#화면-구성)
4. [성장 구조](#성장-구조)
5. [경제 시스템](#경제-시스템)
6. [하트 0 처리 로직 (컨티뉴/종료)](#하트-0-처리-로직-컨티뉴종료)
7. [보상 & 동기부여](#보상--동기부여)
8. [기술 스택](#기술-스택)
9. [퀴즈 데이터](#퀴즈-데이터)
10. [개발 로드맵](#개발-로드맵)
11. [프로젝트 구조](#프로젝트-구조)
12. [시작하기](#시작하기)
13. [참고 문서](#참고-문서)
14. [프로젝트 현황](#프로젝트-현황)
15. [개발 팁](#개발-팁)
16. [기여 방법](#기여-방법)
17. [라이선스](#라이선스)
18. [명확화가 필요한 사항](#명확화가-필요한-사항)
19. [권장 명확화 우선순위](#권장-명확화-우선순위)
20. [변경 이력](#변경-이력)

---

## 🎮 게임 핵심 컨셉

- 퀴즈를 풀며 **의료 히어로**로 성장하는 RPG형 학습 게임
- 스테이지를 **맵** 구조로 배치 → 한 단계씩 지날 때마다 캐릭터 성장
- 기초 지식(남녀노소) → 전문 지식(응급·질환 관리) → 고급 의료(시뮬레이션)까지 난이도 점진 상승
- **하트/점수/아이템 시스템**으로 전략성과 수익화를 동시에 확보

---

## 🔄 핵심 플레이 루프

1. **홈 화면에서 스테이지 선택**
2. **하트(❤️) 1개 소모** → 퀴즈 진행 시작
3. **객관식 4지선다 퀴즈 진행 (스테이지=5문항)**
   - 스테이지 성공/실패 기준: **3문제 이상 맞추면 성공**
   - **5문제 정답**: 보너스 점수 50 + 추가 경험치 + 성공 → 다음 단계 진입 가능
     - 재시도 시: 맞춘 문항 점수만 획득 + 기본 경험치
   - **4문제 정답**: 보너스 점수 30 + 추가 경험치 + 성공 → 다음 단계 진입 가능
     - 재시도 시: 맞춘 문항 점수만 획득 + 기본 경험치
   - **3문제 정답**: 성공 → 다음 단계 진입 가능
     - 재시도 시: 맞춘 문항 점수만 획득 + 기본 경험치
   - **2문제 이하**: 실패 → 재시도 진행
4. **문제 오답 시**
   - 하트 **추가 -1** 및 정답·해설 표시 → 다음 문제
   - **하트가 0이 되면**: 즉시 **컨티뉴 모달** 표시 → [하트 0 처리 로직](#하트-0-처리-로직-컨티뉴종료) 적용
5. **아이템 사용 가능** (보기 삭제, 점수 2배, 자동 정답, 힌트) — 한 문제당 **중복 사용 X**
6. **모든 문제를 마치면 결과 화면**(정답률·점수·보상)
7. **누적 점수로 아이템 구매**
8. **문제를 풀고 경험치를 획득하여 캐릭터 직급·외형 업그레이드**

---

## 🖥️ 화면 구성

### 시작 화면 (구현 완료 ✅)

- **메인 시작 페이지 (`/`)**:

  - 배경: `background-start.png` 전체 화면 배경
  - 캐릭터: `level-20.png` 450px × 450px 크기로 중앙 배치
  - 버튼: "퀴즈 풀러 가기" 버튼 캐릭터와 겹침 배치
  - 레이아웃: 캐릭터 뒤쪽, 버튼 앞쪽 (z-index 활용)
  - 하단 여백: 64px 고정

- **인트로 페이지 (`/intro`)**:
  - 텍스트: "첫걸음은 퀴즈부터!" 등 안내 문구
  - 캐릭터: 동일한 450px × 450px 크기로 배치
  - 버튼: 게임 메인으로 이동하는 버튼

### 홈 화면 (게임 메인)

- **중앙**: 맵 (단계 표시)
- **상단**: 현재 레벨, 진행 스테이지(예: `2-3` = 페이즈2-스테이지3)
- **각 단계 클릭 시**: 퀴즈 풀이 진행(4지선다 5문제)

### 퀴즈 화면

- **상단**: 하트(❤️), 점수(⭐), 진행 스테이지(예: `2-3`)
- **중앙**: 퀴즈 문제/보기 4개
- **하단**: 아이템 슬롯(4종) — 오답 제거 / 점수 2배 / 자동 정답 / 힌트

#### 아이템 사용 규칙

- **한 문제당 중복 사용 불가** (4개 중 하나만)
- **힌트 사용 시**: 배경 블러 + 캐릭터 + 말풍선

### 결과 화면

- 정답률 %, 획득 점수
- EXP 증가, 레벨업 시 캐릭터 변화 연출
- 보상 획득(점수·아이템·배지)

---

## 📈 성장 구조

### 캐릭터 직급 업그레이드

- **Lv.1**: 의대 새내기
- **Lv.5**: 인턴
- **Lv.10**: 레지던트
- **Lv.15**: 전문의
- **Lv.20**: 헬스 히어로 (슈퍼히어로 의상)

### 단계별 지식 트리 (5단계)

1. **1단계**: 민간요법 깨기 (소금물·소주·파스 등)
2. **2단계**: 생활 응급(화상, 출혈, 기도폐쇄)
3. **3단계**: 생활 건강(혈압, 혈당, 복약지도)
4. **4단계**: 전문 응급(심근경색, 뇌졸중 FAST)
5. **5단계**: 고급 시뮬레이션(환자 사례, 종합 퀴즈)

### 레벨 & 경험치(XP) 시스템

#### 시스템 목표

- **성장감**: 짧은 세션에도 레벨업 체감
- **학습 강화**: 첫 클리어·정답률 보너스로 탐색 유도
- **공정성**: 아이템은 점수(⭐) 중심, XP는 학습 기여도 중심

#### 레벨업 필요 XP 공식

```
XP_to_next(L) = round(120 × 1.15^(L-1))
```

- **20레벨 총 필요 XP**: 약 **10,584 XP**

#### 주요 레벨 구간 (누적 XP / 다음 레벨까지 필요 XP)

| 레벨  | 직급        | 누적 XP | 다음 레벨까지 |
| ----- | ----------- | ------- | ------------- |
| Lv.1  | 의대 새내기 | 0       | 120           |
| Lv.5  | 인턴        | 600     | 210           |
| Lv.10 | 레지던트    | 2,015   | 422           |
| Lv.15 | 전문의      | 4,860   | 849           |
| Lv.19 | -           | 9,099   | 1,485         |
| Lv.20 | 헬스 히어로 | 10,584  | -             |

#### XP 획득 규칙

- **문제 정답 XP(난이도별)**: 쉬움 +12 / 보통 +18 / 어려움 +26
- **스테이지 클리어 보너스**: 5정답 +100 / 4정답 +60 / 3정답 +25 / 2이하 0
- **첫 클리어 보너스**: +50 (스테이지 최초 1회)
- **스트릭 보너스(연속 성공)**: +10/회, 최대 +50 (실패 시 초기화)
- **아이템 패널티**: 자동정답 ×0.5 / 힌트 ×0.9 / 오답제거·점수2배 영향 없음
- **반복 감쇠(동일 스테이지 2회차~)**: 클리어 보너스 50%
- **페이즈 완료 보너스**: +225 × 5페이즈

레벨업 보상(코스메틱 중심): 매 레벨 **하트 +1 즉시 회복**(최대치 초과 불가) + 소소한 코스메틱/연출.  
Lv.5/10/15/20 구간에서 일러스트·포즈/테마·의상 파츠 순차 해제, Lv.20은 슈퍼히어로 의상 + **완주 인증서**.

---

## 💰 경제 시스템

### ❤️ 하트 (Heart)

- **최대 5개 보유**
- **스테이지 진입 시**: -1 소모
- **오답 시**: 추가 -1 소모
- **자동 충전**: 5분마다 +1 (최대 5) — HUD에 타이머 표시
- **광고 시청**: +1 회복 (아래 컨티뉴 규칙 참조)

### ⭐ 점수 (Points)

- **문제 정답 기본 점수(난이도 보정)**: 쉬움 10 / 보통 30 / 어려움 50
- **스테이지 클리어 보너스 점수**: 5정답 +50 / 4정답 +30 / 3이하 없음
- **사용처**: 아이템 구매

### 🎁 아이템 (Items)

- 한 문제에서 **중복 사용 X**

1. 오답 제거 - 50점
2. 점수 2배 - 100점 _(점수에만 영향, XP 무관)_
3. 자동 정답 - 200점 _(XP 패널티 적용)_
4. 힌트 제공 - 80점 _(XP 0.9배)_

### 📺 광고 연동

- **하트 충전 광고(컨티뉴)** — [하트 0 처리 로직](#하트-0-처리-로직-컨티뉴종료) 참조
- (추후) 아이템 랜덤 지급, 점수 2배 찬스, 스테이지 보너스 광고 등

---

## ⛑️ 하트 0 처리 로직 (컨티뉴/종료)

> **요약**: 연습 모드 없이 **두 가지 선택**만 제공 — `광고 보고 계속하기` / `종료(실패)`

### 트리거

- 문항이 남아 있는 상태에서 오답으로 **하트가 0**이 되는 순간

### 컨티뉴 모달 (두 가지 선택)

1. **광고 보고 계속하기**

   - 보상형 광고 **완주** 시 **하트 +1** 즉시 회복 → **바로 다음 문항부터 재개**
   - **제한**: `스테이지당 최대 2회`, `일일 최대 5회`(계정 기준)
   - **실패/중도 종료/노필**: “다시 시도” 1회 제공 → 재실패 시 종료만 가능

2. **종료(실패)**
   - 결과 화면으로 이동, **스테이지 실패** 처리
   - **정산**: 이미 맞춘 **문항 단위 점수/XP는 유지**, **스테이지 보너스(정답수/첫클리어/스트릭)**는 **미지급**
   - 결과 화면에서 **다음 자동충전까지 남은 시간(mm:ss)** 노출

### UX 카피 예시

- 타이틀: **하트가 부족해요!**
- 버튼: `▶ 광고 보고 계속 (하트 +1)` / `종료하고 결과 보기 (실패)`
- 보조 문구: `광고가 완료되어야 하트가 충전됩니다.`

### 상태 전이 (State)

```
PLAYING
  └─(오답 → hearts--)→  hearts > 0 ? PLAYING : HEARTS_EMPTY_MODAL

HEARTS_EMPTY_MODAL
  ├─ 광고 시청 성공(rewarded) → hearts++ → PLAYING (다음 문항)
  └─ 종료 선택 → FAIL_RESULT
```

### 안전장치 & 서버 검증

- 광고 보상은 **SDK reward 콜백 수신 시점**에만 지급
- 서버에서 `perStage`/`perDay` 제한을 검증 및 카운팅(조작 방지)
- 네트워크/노필 케이스: 재시도 1회 후 종료만 허용

### 설정(JSON 예시)

```json
{
  "hearts": { "max": 5, "rechargeSec": 300 },
  "continue": {
    "ad": { "enabled": true, "perStageMax": 2, "perDayMax": 5 },
    "exit": { "keepQuestionGains": true, "grantStageBonuses": false }
  },
  "ui": { "showRechargeTimerOnFail": true }
}
```

### 분석 이벤트 (예시)

- `ad_continue_shown(stage_id, q_left)`
- `ad_continue_click` / `ad_continue_rewarded` / `ad_continue_failed(no_fill|network|closed)`
- `ad_continue_cap_reached(stage|daily)`
- `stage_failed_heart_empty(answered, correct_count)`

---

## 🎁 보상 & 동기부여

- **배지/칭호**: 단계별 학습 달성 시 (후순위)
- **출석 보상**: 연속 접속 시 하트/아이템 지급
- **소셜 공유**: 최종 "헬스 히어로 인증서" 이미지 공유

---

## 🛠️ 기술 스택

### Frontend

- **Framework**: Next.js 15.5.5 (App Router, TypeScript)
- **Game Engine**: Phaser 3.90.0 (퀴즈/애니메이션)
- **Styling**: Tailwind CSS 4
- **State Management**: Zustand 5.0.8
- **Animation**: Framer Motion 12.23.24
- **UI Components**: Lucide React 0.545.0
- **Utilities**: clsx, tailwind-merge, use-local-storage-state 등

### Backend

- **Database & Auth**: Supabase 2.75.0
- **API**: Supabase REST

### PWA

- **PWA Support**: next-pwa 5.6.0

### Design & Assets

- **Sprite**: Aseprite
- **Atlas**: TexturePacker (JSON)
- **UI Design**: Figma

### Deployment

- **Frontend**: Vercel
- **Backend**: Supabase
- **Analytics**: PostHog/Amplitude (예정)

---

## 📚 퀴즈 데이터

### 데이터 소스

- 로컬 파일: `health-hero_Q1-200_v2_4choice_with_hints_ko_2025-10-14_NO-GENERIC-CHOICE4_fromTXT.csv`
- 총 200문항 / CSV 형식

### 데이터 구조

```json
{
  "qnum": 1,
  "topic": "감기·호흡기 오해",
  "prompt": "감기에 항생제를 먹으면 빨리 낫는다.",
  "choices": [
    "대부분 맞다",
    "대부분 아니다",
    "코로나일 때만 맞다",
    "증상이 좋아지면 항생제는 바로 중단해도 된다"
  ],
  "answer_index": 2,
  "hint": "감기의 주된 원인(바이러스 vs 세균)과 항생제가 작용하는 대상을 구분해 보세요.",
  "explanation": "감기의 상당수는 바이러스 원인이어서 항생제가 효과 없고, 오남용은 내성만 늘립니다.",
  "difficulty_label": "쉬움"
}
```

### 난이도 레벨 및 점수

| 난이도 | 점수 | 문제 수 | 비율 |
| ------ | ---- | ------- | ---- |
| 쉬움   | 10점 | ~100개  | 50%  |
| 보통   | 30점 | ~70개   | 35%  |
| 어려움 | 50점 | ~30개   | 15%  |

### 스테이지별 난이도 배치 전략

```
1스테이지: 쉬움 5문제 (랜덤 선택)
2스테이지: 쉬움 5문제 (랜덤 선택)
3스테이지: 보통 5문제 (랜덤 선택)
4스테이지: 보통 5문제 (랜덤 선택)
5스테이지: 어려움 5문제 (랜덤 선택)
```

### 주제 분류 (각 10문제씩, 총 20개 주제)

1. **감기·호흡기 오해** (Q001-Q010)
2. **화상·일광화상** (Q011-Q020)
3. **영양·식습관** (Q021-Q030)
4. **눈·귀·피부·자외선** (Q031-Q040)
5. **코피·비강 응급** (Q041-Q050)
6. **동물·곤충·뱀 사고** (Q051-Q060)
7. **상처·지혈·골절** (Q061-Q070)
8. **기도폐쇄·질식** (Q071-Q080)
9. **화학물질·중독** (Q081-Q090)
10. **심혈관 응급** (Q091-Q100)
11. **치아·구강 응급·위생** (Q101-Q110)
12. **온열·저체온** (Q111-Q120)
13. **의약품·복약 안전** (Q121-Q130)
14. **감염병·손위생** (Q131-Q140)
15. **식품 안전·보관** (Q141-Q150)
16. **손 위생·소독제** (Q151-Q160)
17. **운동·자세·근골격** (Q161-Q170)
18. **수면·정신건강** (Q171-Q180)
19. **연령·상황별 안전** (Q181-Q190)
20. **노인 건강·낙상·탈수** (Q191-Q200)

### 퀴즈 선택 로직

- **랜덤 선택**: 각 스테이지마다 해당 난이도의 문제를 랜덤하게 5개 선택
- **재시도 시**: 같은 스테이지 재도전 시 다른 문제들로 교체
- **주제 밸런싱**: 가능한 한 같은 주제가 연속으로 나오지 않도록 조정
- **총 문제 수**: 4페이즈 × 5스테이지 × 5문제 = 100문제 (200개 중 100개 활용)

---

## 🗺️ 개발 로드맵

### Phase 1: 프로젝트 초기 세팅 ✅

- Next.js/Phaser/Supabase/Zustand/Tailwind/next-pwa 설치
- Apps In Toss 프레임워크 설정
- 문서화 (PROJECT.md)

**완료 기준**: 개발 서버 실행, 기본 라이브러리 설치 완료

### Phase 2: DB 스키마 & 데이터 임포트 ✅

- ✅ Supabase 프로젝트/환경변수 설정 완료
- ✅ 스키마 구현 완료:
  - `user_profiles(level, current_exp, total_score, current_streak, current_stage, current_phase)` ✅
  - `quizzes(qnum, topic, prompt, choices JSONB, answer_index, hint, explanation, difficulty_label, difficulty_level)` ✅
  - `user_progress(user_id, phase, stage, completed, score, attempts, correct_count)` ✅
  - `user_quiz_records(user_id, quiz_id, phase, stage, is_correct, score_earned, items_used)` ✅
  - `user_item_settings(user_id, item_type, show_popup)` ✅
  - `user_hearts(user_id, current_hearts, last_refill_at, ad_views_today)` ✅
- ✅ CSV → JSON 변환 & 임포트 완료 (200문항)
- ✅ RLS 정책 및 보안 설정 완료
- ✅ 하트 자동 충전 함수 구현 완료

**완료 기준**: ✅ 200문항 DB 적재, 난이도별 인덱싱, 퀴즈 선택 로직 구현

### Phase 3: 핵심 게임 메커니즘

- Zustand 스토어: 유저/하트/스테이지/인벤토리/퀴즈 세션
- 하트 자동충전(5분 +1), 최대 5
- 하트 소모(입장 -1, 오답 -1)
- **하트 0 컨티뉴 모달(광고 스텁)** ← _신규 반영_
- 점수/경험치/보너스/패널티 로직
- 아이템(오답제거/점수2배/자동정답/힌트) — 한 문제당 1개

**완료 기준**: 핵심 로직 동작, 단위 테스트 통과

### Phase 4: UI/UX

- **시작 페이지 UI 완료** ✅
  - 메인 시작 페이지 (`/`) - 배경 + 캐릭터 + 버튼
  - 인트로 페이지 (`/intro`) - 텍스트 + 캐릭터 + 버튼
  - 모바일 친화적 반응형 디자인
  - 캐릭터-버튼 겹침 레이아웃 (450px 캐릭터, 64px 하단 여백)
- 홈/퀴즈/결과 화면
- 모달/버튼/프로그레스/하트/스코어 공통 컴포넌트
- 힌트 모달(블러+캐릭터 말풍선)
- 컨티뉴 모달 UX/카피 적용

### Phase 5: Phaser 씬 & 캐릭터

- Phaser 인스턴스/씬(Main/Quiz/Result)
- 캐릭터 스프라이트(Lv.1/5/10/15/20) & 레벨업 연출
- 스테이지 맵/잠금 해제 이펙트

### Phase 6: 광고 연동 (실구현)

- 광고 SDK 통합(예: Google AdMob)
- **하트 컨티뉴 광고** 실제 보상 연동
- (선택) 아이템 지급/점수 2배/보너스 광고

### Phase 7: PWA/최적화/테스트/배포

- PWA(오프라인/아이콘/manifest)
- 성능 최적화(이미지/코드 스플릿/캐싱)
- 유닛/통합/E2E/디바이스/브라우저 테스트
- Vercel 배포/도메인/HTTPS/Analytics
- 모니터링(Sentry, PostHog/Amplitude)

---

## 📁 프로젝트 구조

```
health-hero/
├── public/
│   ├── images/          # 이미지 리소스
│   ├── sounds/          # 사운드 이펙트
│   ├── icons/           # PWA 아이콘
│   └── manifest.json    # PWA 매니페스트
├── src/
│   ├── app/             # Next.js App Router
│   │   ├── layout.tsx
│   │   ├── page.tsx     # 홈 화면
│   │   ├── quiz/        # 퀴즈 화면
│   │   └── result/      # 결과 화면
│   ├── components/      # React 컴포넌트
│   │   ├── common/      # 공통 컴포넌트
│   │   ├── quiz/        # 퀴즈 관련
│   │   ├── home/        # 홈 관련
│   │   └── result/      # 결과 관련
│   ├── lib/             # 유틸리티 & 설정
│   │   ├── supabase.ts  # Supabase 클라이언트
│   │   ├── utils.ts     # 유틸 함수
│   │   └── constants.ts # 상수
│   ├── hooks/           # Custom Hooks
│   ├── stores/          # Zustand 스토어
│   │   ├── gameStore.ts
│   │   └── quizStore.ts
│   ├── scenes/          # Phaser 3 씬
│   │   ├── MainScene.ts
│   │   ├── QuizScene.ts
│   │   └── ResultScene.ts
│   ├── game/            # 게임 로직
│   │   ├── GameManager.ts
│   │   └── PhaserConfig.ts
│   ├── types/           # TypeScript 타입
│   └── constants/       # 게임 상수
├── granite.config.ts
├── next.config.ts
├── tailwind.config.ts
├── tsconfig.json
├── package.json
├── .env.local
├── PROJECT.md           # 본 문서
└── README.md
```

---

## 🚀 시작하기

### 개발 서버

```bash
npm run dev
```

브라우저 `http://localhost:5173`

### 빌드

```bash
npm run build
```

### 배포

```bash
npm run deploy
```

---

## 📝 참고 문서

- [Next.js Documentation](https://nextjs.org/docs)
- [Phaser 3 Documentation](https://photonstorm.github.io/phaser3-docs/)
- [Supabase Documentation](https://supabase.com/docs)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [Zustand Documentation](https://github.com/pmndrs/zustand)
- [Framer Motion Documentation](https://www.framer.com/motion/)

---

## 📊 프로젝트 현황

- **프로젝트 시작일**: 2025-10-14
- **현재 단계**: Phase 4 진행 중 ✅ (퀴즈 페이지 구현 완료)
- **완료된 기능**:
  - ✅ Phase 1: 프로젝트 설정 및 기본 구조
  - ✅ Phase 2: DB 스키마 & 데이터 임포트
  - ✅ Phase 3-1: 메인 게임 페이지 UI 구현
  - ✅ Phase 3-2: 실제 데이터 연동 및 최적화
  - ✅ Phase 3-3: 스테이지 페이지 구현 및 반응형 시스템
  - ✅ Phase 4-1: 퀴즈 페이지 구현 및 보안 강화
- **다음 단계**: Phase 4-2 - 퀴즈 게임 로직 완성

---

## 💡 개발 팁

### 퀴즈 데이터 변환 예시

```typescript
// CSV → JSON 배열 변환
const quizzes = csvData.map((quiz) => ({
  id: quiz.qnum,
  topic: quiz.topic,
  prompt: quiz.prompt,
  choices: quiz.choices,
  correctAnswer: quiz.answer_index, // 0~3 (인덱스)
  hint: quiz.hint,
  explanation: quiz.explanation,
  difficulty:
    quiz.difficulty_label === "쉬움"
      ? "easy"
      : quiz.difficulty_label === "보통"
      ? "medium"
      : "hard",
  points:
    quiz.difficulty_label === "쉬움"
      ? 10
      : quiz.difficulty_label === "보통"
      ? 30
      : 50,
}));

// 난이도별 퀴즈 선택 로직
async function getRandomQuizzesByDifficulty(difficulty: string, count: number) {
  const { data } = await supabase
    .from("quizzes")
    .select("*")
    .eq("difficulty", difficulty)
    .order("random()")
    .limit(count);
  return data || [];
}

// 스테이지별 퀴즈 생성
function generateStageQuizzes(stage: number) {
  const difficultyMap = {
    1: "easy",
    2: "easy",
    3: "medium",
    4: "medium",
    5: "hard",
  };
  return getRandomQuizzesByDifficulty(difficultyMap[stage], 5);
}
```

### 하트 자동 충전 로직 예시

```typescript
const HEART_REFILL_INTERVAL = 5 * 60 * 1000; // 5분
const MAX_HEARTS = 5;
setInterval(() => {
  const currentHearts = getHearts();
  if (currentHearts < MAX_HEARTS) setHearts(currentHearts + 1);
}, HEART_REFILL_INTERVAL);
```

### 하트 0 컨티뉴 모달 로직(의사코드)

```typescript
if (hearts === 0 && questionsLeft > 0) {
  pauseGame();
  openContinueModal({
    onAdClick: async () => {
      const ok = await showRewardedAd(); // SDK
      if (ok && canReward()) {
        hearts++;
        resumeGame();
      } else if (canRetryAdOnce()) {
        showRetry();
      } else {
        gotoFailResult();
      }
    },
    onExit: () => gotoFailResult(),
  });
}
```

---

## 🤝 기여 방법

현재는 개인 프로젝트이나, 추후 오픈소스화 예정

---

## 📄 라이선스

MIT License (예정)

---

## ⚠️ 명확화가 필요한 사항

### 🔍 모호한 부분 체크리스트

1. **맵 구조 디자인 상세 사양**
   - 스테이지 배치(페이즈×스테이지 수) 확정 필요
2. **경험치 & 레벨업 시스템**
   - 수치 확정(현재 문서의 기본안 적용 중)
3. **스테이지 재시도 메커니즘** ✅
   - 재시도 시 **다른 문제 제공**, 보너스는 재지급 없음(문항 점수만) 확정
4. **하트 소모 상세**
   - 스테이지 입장 -1, 오답 -1, **하트 0시 컨티뉴 모달(광고/종료)**
   - 하트 0 상태로 스테이지 진입 불가 (대기 또는 광고로 충전)
5. **아이템 구매 시스템**
   - 보유 방식(인벤토리/실시간 구매) 및 보유 상한
6. **스테이지 난이도 구성** ✅
   - 페이즈별 난이도 혼합 비율 확정 (쉬움→쉬움→보통→보통→어려움)
7. **페이즈-단계 표기**
   - UI 네이밍 규칙(`P-S` 포맷 등)
8. **광고 연동 우선순위**
   - Phase 3에서 **모달·SDK 스텁**, Phase 6에서 **실구현**
   - 일일/스테이지 제한 수치 최종 확정
9. **출석 보상 상세**
   - 연속 보상 테이블(1/3/7/14일 등)
10. **데이터 동기화**

- 저장 시점(문제 단위 vs 스테이지 종료), 오프라인 동기화

11. **보안 & 치팅 방지**

- 정답 검증/점수 서버 확인, 광고 보상 서버 검증

---

## 💡 권장 명확화 우선순위

- ✅ 결정: 하트 0 **컨티뉴(광고)/종료** 2경로 확정
- ✅ 결정: 레벨/XP 공식·보너스·패널티·감쇠
- ✅ 결정: **스테이지별 난이도 배치** (쉬움→쉬움→보통→보통→어려움)
- ✅ 결정: **퀴즈 선택 로직** (랜덤 선택, 재시도 시 다른 문제)
- ✅ 결정: **시작 페이지 UI 레이아웃** (캐릭터-버튼 겹침, 모바일 최적화)
- 🟡 진행: 맵 구조 디자인
- 🔴 필요: 아이템 보유/구매 UX, 데이터 동기화, 광고 수치 최종안

---

## 📝 변경 이력

### 2025-10-21

- **Phase 2 완료**: DB 스키마 & 데이터 임포트 ✅
  - Supabase 퀴즈 관련 테이블 6개 생성 완료
  - 200개 퀴즈 데이터 CSV → JSONB 변환 및 업로드 완료
  - RLS 정책 및 보안 설정 완료
  - 하트 자동 충전 함수 구현 완료
  - 게스트 로그인 기능 추가 (Supabase Anonymous Auth)
- **데이터베이스 스키마 확장**:
  - `quizzes` 테이블: 퀴즈 데이터 저장 (JSONB choices 배열)
  - `user_progress` 테이블: 사용자 진행 상황 추적
  - `user_quiz_records` 테이블: 퀴즈 결과 기록
  - `user_item_settings` 테이블: 아이템 팝업 설정
  - `user_hearts` 테이블: 하트 시스템 관리
- **보안 강화**: RLS 정책으로 사용자별 데이터 접근 제어
- **개발 환경 개선**: 게스트 로그인으로 UI 개발 가속화

### 2025-10-21 (최신)

- **스테이지 페이지 구현 완료**:
  - Phase 1-4 스테이지 맵 페이지 구현 (`/game/phase1`, `/game/phase2`, `/game/phase3`, `/game/phase4`)
  - 각 페이즈별 고유 배경 이미지 적용
  - 5개 스테이지 버튼 세로 배치 (64x64px 파란색 그라데이션)
  - 뒤로가기 버튼 구현 (`icon-backspace.png` 24x24px)
- **스테이지 잠금 시스템 구현**:
  - `gameStore`에 `currentStage` 필드 추가
  - 실제 데이터 기반 스테이지 잠금 상태 결정
  - 잠금된 스테이지에 `icon-lock.png` 표시
  - 클릭 방지 및 시각적 피드백 제공
- **반응형 스크롤 시스템 구현**:
  - 화면 높이 700px 기준으로 작은 화면 감지
  - 작은 화면: 스크롤 활성화, 조밀한 스테이지 배치
  - 일반 화면: 스크롤 비활성화, 여유로운 스테이지 배치
  - 메인 페이지와 모든 페이즈 페이지에 동일 적용
- **로딩 화면 개선**:
  - 검정색 배경 제거, 각 페이지의 실제 배경 이미지 사용
  - 로딩 중에도 페이지 분위기 유지
  - 일관된 사용자 경험 제공
- **UI/UX 최적화**:
  - 스테이지 버튼 투명 처리 제거로 선명한 표시
  - 페이즈 블록 반투명 효과 제거로 명확한 구분
  - 모든 페이지에서 일관된 반응형 동작

### 2025-10-21 (이전)
  - 고정 헤더 구현 (캐릭터, 레벨, 하트, 점수, 설정 버튼)
  - 실제 데이터베이스 연동 (`currentPhase` 기반 페이즈 상태)
  - 4개 페이즈 블록 및 연결선 구현 (150x160px 블러 처리)
  - 스크롤 가능한 메인 콘텐츠 영역
  - 새로고침 시 스크롤 하단 고정 기능
- **데이터 연동 및 최적화**:
  - `gameStore`에 `currentPhase` 필드 추가
  - 페이즈 상태 결정 로직 개선 (실제 데이터 기반)
  - `refill_heart` 불필요한 반복 호출 최적화 (97% 감소)
  - 하트 타이머 로직 개선 (5개일 때 "충전 완료" 표시)
- **UI/UX 개선**:
  - 캐릭터 이미지 레벨별 동적 로딩
  - 페이즈 이미지 상태별 표시 (활성화/잠금)
  - 반응형 레이아웃 및 모바일 최적화
  - 이미지 최적화 및 로딩 성능 개선

### 2025-10-15

- **하트 0 처리 로직(광고 컨티뉴/종료) 섹션 신설** 및 루프/경제/로드맵 반영
- 퀴즈 화면 오답 처리에 컨티뉴 모달 링크 추가
- 분석 이벤트/상태 전이/설정 JSON 예시 추가
- **퀴즈 데이터 섹션 대폭 업데이트**:
  - 200개 퀴즈 상세 분류 (20개 주제, 난이도별 분포)
  - 스테이지별 난이도 배치 전략 확정 (쉬움→쉬움→보통→보통→어려움)
  - 퀴즈 선택 로직 상세화 (랜덤 선택, 재시도 시 다른 문제)
  - CSV 데이터 구조 및 변환 예시 코드 추가
- **시작 페이지 UI 구현 완료**:
  - 메인 시작 페이지 (`/`) 및 인트로 페이지 (`/intro`) 구현
  - 모바일 친화적 반응형 디자인 적용
  - 캐릭터-버튼 겹침 레이아웃 최적화 (450px 캐릭터, 64px 하단 여백)
  - Next.js Image 컴포넌트 최적화 및 CSS 스타일링
  - 화면 스크롤 방지 및 레이아웃 안정화

### 2025-10-14

- 프로젝트 초기 문서 생성, 계단→맵 구조 변경
- 핵심 메커니즘/아이템/레벨&경험치 시스템 확정
- 명확화 체크리스트 12항목 작성

**Last Updated**: 2025-10-21
