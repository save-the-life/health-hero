# ë¬¼ë¦¬ì  ìƒí’ˆ(ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜) ë°°ì†¡ ì „ëµ

**ìƒí’ˆ ìœ í˜•:** ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ (ë¬¼ë¦¬ì  ë°°ì†¡ í•„ìš”)
**ë°°ì†¡ í”„ë¡œì„¸ìŠ¤:** ì´ë²¤íŠ¸ ë‹¬ì„± â†’ ê³ ì§€ â†’ ë°°ì†¡ì§€ ì…ë ¥ â†’ ë°°ì†¡
**ë¶„ì„ ì¼ì:** 2026-01-04

---

## ğŸ¯ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

**ì§ˆë¬¸:** "ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ë¡œ ë¨¼ì € ê³ ì§€í•œ í›„ ë°°ì†¡í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ?"

**ë‹µë³€:** âœ… **ë§ìŠµë‹ˆë‹¤!** ì´ ë°©ì‹ì´ í›¨ì”¬ í•©ë¦¬ì ì…ë‹ˆë‹¤.

### ì €ì¥ ë°©ì‹ ì¬í‰ê°€

| ì‹œë‚˜ë¦¬ì˜¤ | í•„ìš” ì •ë³´ | í† ìŠ¤ ì´ë©”ì¼ í™œìš© | ê¶Œì¥ë„ |
|----------|-----------|------------------|--------|
| **ë””ì§€í„¸ ìƒí’ˆ** (ì¿ í°, í¬ì¸íŠ¸) | ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ | ğŸŸ¡ ì‹ ì¤‘íˆ | ë³„ë„ ìˆ˜ì§‘ |
| **ë¬¼ë¦¬ì  ìƒí’ˆ** (ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜) | ë°°ì†¡ì§€ ì£¼ì†Œ | âœ… **ì ê·¹ í™œìš©** | í† ìŠ¤ ì •ë³´ í™œìš© ê°€ëŠ¥ |

---

## 1. ë¬¼ë¦¬ì  ìƒí’ˆ ë°°ì†¡ í”„ë¡œì„¸ìŠ¤

### 1.1 ê¶Œì¥ íë¦„

```
[ì‚¬ìš©ìê°€ ì´ë²¤íŠ¸ ë‹¬ì„±]
   â†“
[ì¶•í•˜ ëª¨ë‹¬ í‘œì‹œ]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ‰ ì´ë²¤íŠ¸ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!

  ë‹¹ì²¨ ìƒí’ˆ: ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜

  ğŸ“§ ë‹¹ì²¨ ì•ˆë‚´ëŠ” ì´ë©”ì¼/ë¬¸ìë¡œ ë°œì†¡ë©ë‹ˆë‹¤.
  ë°°ì†¡ì§€ ì…ë ¥ ì•ˆë‚´ ë¬¸ìë¥¼ ë°›ìœ¼ì‹œë©´
  ë§í¬ë¥¼ í†µí•´ ë°°ì†¡ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.

  ì˜ˆìƒ ë°œì†¡ ì‹œê°„: 2~3ì¼ ì´ë‚´

  [í™•ì¸] ë²„íŠ¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   â†“
[ê´€ë¦¬ìê°€ ë‹¹ì²¨ì í™•ì¸]
   â†“
[í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ë¡œ ê³ ì§€]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  [í—¬ìŠ¤íˆì–´ë¡œ] ì´ë²¤íŠ¸ ë‹¹ì²¨ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!

  ë‹¹ì²¨ ìƒí’ˆ: ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜

  ì•„ë˜ ë§í¬ì—ì„œ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
  ğŸ”— https://health-hero.app/reward/shipping/[í† í°]

  â€» ë§í¬ ìœ íš¨ê¸°ê°„: 7ì¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   â†“
[ì‚¬ìš©ìê°€ ë§í¬ í´ë¦­]
   â†“
[ë°°ì†¡ì§€ ì…ë ¥ í˜ì´ì§€]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ë°°ì†¡ ì •ë³´ ì…ë ¥

  ë°›ëŠ” ì‚¬ëŒ: [í™ê¸¸ë™]
  ì „í™”ë²ˆí˜¸: [010-0000-0000]
  ì£¼ì†Œ: [ì„œìš¸ì‹œ ê°•ë‚¨êµ¬...]

  â˜‘ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ (ë°°ì†¡ ëª©ì )

  [ì œì¶œí•˜ê¸°]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   â†“
[ê´€ë¦¬ìê°€ ë°°ì†¡ ì²˜ë¦¬]
   â†“
[ë°°ì†¡ ì™„ë£Œ]
```

---

## 2. í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ í™œìš© ê°€ëŠ¥ ì—¬ë¶€

### 2.1 ë²•ì  ê²€í† 

**ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì œ15ì¡° ì œ1í•­ ì œ4í˜¸:**
> ê³„ì•½ì˜ ì²´ê²° ë° ì´í–‰ì„ ìœ„í•˜ì—¬ **ë¶ˆê°€í”¼í•˜ê²Œ í•„ìš”í•œ ê²½ìš°**

**í•´ì„:**
```
[ì´ë²¤íŠ¸ ë‹¹ì²¨ = ê³„ì•½ ì²´ê²°]
- ì‚¬ìš©ì: ì´ë²¤íŠ¸ ì°¸ì—¬ (ê³„ì•½ ì‹ ì²­)
- ì„œë¹„ìŠ¤: ìƒí’ˆ ì œê³µ ì•½ì† (ê³„ì•½ ìˆ˜ë½)
- ìƒí’ˆ ë°°ì†¡: ê³„ì•½ ì´í–‰

â†’ ë°°ì†¡ì„ ìœ„í•œ ì—°ë½ì€ "ê³„ì•½ ì´í–‰ì— ë¶ˆê°€í”¼"
â†’ í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ í™œìš© ê°€ëŠ¥ âœ…
```

### 2.2 ì¡°ê±´ë¶€ í™œìš© ê°€ëŠ¥

| ì¡°ê±´ | í•„ìš”ì„± | ì„¤ëª… |
|------|--------|------|
| **1. ëª…í™•í•œ ê³ ì§€** | âœ… í•„ìˆ˜ | ì´ë²¤íŠ¸ ê·œì •ì— "ë‹¹ì²¨ ì‹œ ì—°ë½ì²˜ë¡œ ê³ ì§€" ëª…ì‹œ |
| **2. ìµœì†Œí•œì˜ ì‚¬ìš©** | âœ… í•„ìˆ˜ | ë°°ì†¡ì§€ ì…ë ¥ ì•ˆë‚´ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš© |
| **3. ì¦‰ì‹œ íê¸°** | âœ… í•„ìˆ˜ | ë°°ì†¡ ì™„ë£Œ í›„ ì •ë³´ ì‚­ì œ |

### 2.3 ì´ë²¤íŠ¸ ê·œì • ì˜ˆì‹œ

```markdown
## ì´ë²¤íŠ¸ ì°¸ì—¬ ì•½ê´€

### ì œ1ì¡° (ë‹¹ì²¨ì ë°œí‘œ ë° ìƒí’ˆ ì§€ê¸‰)
1. ë‹¹ì²¨ìëŠ” ì•± ë‚´ ê³µì§€ ë° **ë“±ë¡ëœ ì´ë©”ì¼/íœ´ëŒ€ì „í™”ë²ˆí˜¸ë¡œ ê°œë³„ ì•ˆë‚´**ë©ë‹ˆë‹¤.
2. ë‹¹ì²¨ìëŠ” ì•ˆë‚´ ë¬¸ì/ì´ë©”ì¼ì˜ ë§í¬ë¥¼ í†µí•´ **ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì…ë ¥**í•´ì•¼ í•©ë‹ˆë‹¤.
3. ë°°ì†¡ì§€ ì •ë³´ ë¯¸ì…ë ¥ ì‹œ ë‹¹ì²¨ì´ ì·¨ì†Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì œ2ì¡° (ê°œì¸ì •ë³´ ì²˜ë¦¬)
1. ë‹¹ì²¨ ì•ˆë‚´ë¥¼ ìœ„í•´ íšŒì›ê°€ì… ì‹œ ì œê³µí•œ **ì´ë©”ì¼ ë˜ëŠ” íœ´ëŒ€ì „í™”ë²ˆí˜¸ë¥¼ í™œìš©**í•©ë‹ˆë‹¤.
2. ë°°ì†¡ì„ ìœ„í•œ ì£¼ì†Œ, ìˆ˜ë ¹ì¸ ì •ë³´ëŠ” **ë³„ë„ ìˆ˜ì§‘**í•˜ë©°, ë°°ì†¡ ì™„ë£Œ í›„ ì¦‰ì‹œ íŒŒê¸°í•©ë‹ˆë‹¤.
```

---

## 3. DB ìŠ¤í‚¤ë§ˆ ì„¤ê³„

### 3.1 ê°„ì†Œí™”ëœ í…Œì´ë¸” êµ¬ì¡°

```sql
-- ì´ë²¤íŠ¸ ë‹¹ì²¨ì ë° ë°°ì†¡ ê´€ë¦¬ í…Œì´ë¸”
CREATE TABLE event_winners (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,

  -- ì´ë²¤íŠ¸ ì •ë³´
  event_id TEXT NOT NULL,
  event_name TEXT NOT NULL,
  reward_type TEXT NOT NULL,  -- 'smart_watch'

  -- ë‹¹ì²¨ ì •ë³´
  won_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  notification_sent_at TIMESTAMP WITH TIME ZONE,  -- ê³ ì§€ ë°œì†¡ ì‹œê°
  notification_method TEXT,  -- 'email' | 'sms' | 'both'

  -- ë°°ì†¡ì§€ ì…ë ¥ ë§í¬
  shipping_token TEXT UNIQUE,  -- ë°°ì†¡ì§€ ì…ë ¥ìš© í† í°
  shipping_link_expires_at TIMESTAMP WITH TIME ZONE,  -- ë§í¬ ë§Œë£Œ ì‹œê°

  -- ë°°ì†¡ ì •ë³´ (ì‚¬ìš©ìê°€ ë³„ë„ ì…ë ¥)
  recipient_name TEXT,
  recipient_phone TEXT,
  shipping_address TEXT,
  shipping_address_detail TEXT,
  shipping_zipcode TEXT,
  shipping_memo TEXT,

  -- ë°°ì†¡ì§€ ì…ë ¥ ë™ì˜
  shipping_consent_at TIMESTAMP WITH TIME ZONE,
  shipping_consent_ip INET,

  -- ë°°ì†¡ ìƒíƒœ
  status TEXT DEFAULT 'pending' CHECK (status IN (
    'pending',          -- ëŒ€ê¸° (ê³ ì§€ ì „)
    'notified',         -- ê³ ì§€ ì™„ë£Œ
    'shipping_info_received',  -- ë°°ì†¡ì§€ ì…ë ¥ ì™„ë£Œ
    'shipped',          -- ë°°ì†¡ ì¤‘
    'delivered',        -- ë°°ì†¡ ì™„ë£Œ
    'expired',          -- ë§í¬ ë§Œë£Œ (ë¯¸ì…ë ¥)
    'cancelled'         -- ì·¨ì†Œ
  )),

  -- ë°°ì†¡ ì¶”ì 
  tracking_number TEXT,
  shipped_at TIMESTAMP WITH TIME ZONE,
  delivered_at TIMESTAMP WITH TIME ZONE,

  -- ê°ì‚¬ ë¡œê·¸
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(user_id, event_id)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_event_winners_status ON event_winners(status);
CREATE INDEX idx_event_winners_token ON event_winners(shipping_token);
CREATE INDEX idx_event_winners_event_id ON event_winners(event_id);

-- RLS ì •ì±…
ALTER TABLE event_winners ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own winner records" ON event_winners
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can update own shipping info" ON event_winners
  FOR UPDATE USING (auth.uid() = user_id);
```

---

## 4. êµ¬í˜„ ë‹¨ê³„ë³„ ê°€ì´ë“œ

### 4.1 ì´ë²¤íŠ¸ ë‹¬ì„± ì‹œ (ì¦‰ì‹œ ì²˜ë¦¬)

```typescript
// src/services/eventService.ts

async function handleEventSuccess(userId: string, eventId: string) {
  // 1. event_winners í…Œì´ë¸”ì— ë‹¹ì²¨ì ë“±ë¡
  const shippingToken = generateSecureToken(); // UUID ë˜ëŠ” ëœë¤ í† í°
  const expiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000); // 7ì¼ í›„

  const { data: winner, error } = await supabase
    .from('event_winners')
    .insert({
      user_id: userId,
      event_id: eventId,
      event_name: 'ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ ì´ë²¤íŠ¸',
      reward_type: 'smart_watch',
      status: 'pending',
      shipping_token: shippingToken,
      shipping_link_expires_at: expiresAt.toISOString()
    })
    .select()
    .single();

  if (error) throw error;

  // 2. ì‚¬ìš©ìì—ê²Œ ë‹¹ì²¨ ëª¨ë‹¬ í‘œì‹œ
  return {
    success: true,
    message: 'ë‹¹ì²¨ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ë°°ì†¡ì§€ ì…ë ¥ ì•ˆë‚´ë¥¼ ê³§ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
    winner
  };
}
```

### 4.2 ê´€ë¦¬ì ê³ ì§€ ë°œì†¡ (ìˆ˜ë™/ìë™)

```typescript
// src/services/notificationService.ts

async function sendWinnerNotification(winnerId: string) {
  // 1. ë‹¹ì²¨ì ì •ë³´ ì¡°íšŒ
  const { data: winner } = await supabase
    .from('event_winners')
    .select(`
      *,
      user:user_profiles(toss_email, toss_phone, name)
    `)
    .eq('id', winnerId)
    .single();

  if (!winner) throw new Error('ë‹¹ì²¨ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  // 2. ë°°ì†¡ì§€ ì…ë ¥ ë§í¬ ìƒì„±
  const shippingLink = `https://health-hero.app/reward/shipping/${winner.shipping_token}`;

  // 3. ì´ë©”ì¼ ë°œì†¡ (í† ìŠ¤ ì´ë©”ì¼ í™œìš©)
  if (winner.user.toss_email) {
    await sendEmail({
      to: winner.user.toss_email,
      subject: '[í—¬ìŠ¤íˆì–´ë¡œ] ì´ë²¤íŠ¸ ë‹¹ì²¨ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ğŸ‰',
      html: `
        <h2>ğŸ‰ ${winner.user.name}ë‹˜, ë‹¹ì²¨ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!</h2>
        <p>ë‹¹ì²¨ ìƒí’ˆ: <strong>${winner.reward_type}</strong></p>
        <p>ì•„ë˜ ë§í¬ì—ì„œ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:</p>
        <a href="${shippingLink}">${shippingLink}</a>
        <p>â€» ë§í¬ ìœ íš¨ê¸°ê°„: 7ì¼</p>
        <p>ê¸°ê°„ ë‚´ ë¯¸ì…ë ¥ ì‹œ ë‹¹ì²¨ì´ ì·¨ì†Œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      `
    });
  }

  // 4. SMS ë°œì†¡ (í† ìŠ¤ ì „í™”ë²ˆí˜¸ í™œìš©)
  if (winner.user.toss_phone) {
    await sendSMS({
      to: winner.user.toss_phone,
      message: `[í—¬ìŠ¤íˆì–´ë¡œ] ${winner.user.name}ë‹˜ ë‹¹ì²¨ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤! ë°°ì†¡ì§€ ì…ë ¥: ${shippingLink} (ìœ íš¨ê¸°ê°„ 7ì¼)`
    });
  }

  // 5. ë°œì†¡ ê¸°ë¡ ì—…ë°ì´íŠ¸
  await supabase
    .from('event_winners')
    .update({
      status: 'notified',
      notification_sent_at: new Date().toISOString(),
      notification_method: winner.user.toss_email && winner.user.toss_phone
        ? 'both'
        : winner.user.toss_email
        ? 'email'
        : 'sms'
    })
    .eq('id', winnerId);

  return { success: true };
}
```

### 4.3 ë°°ì†¡ì§€ ì…ë ¥ í˜ì´ì§€

```typescript
// src/app/reward/shipping/[token]/page.tsx
'use client';

import { useEffect, useState } from 'react';
import { useParams, useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';

export default function ShippingInfoPage() {
  const params = useParams();
  const router = useRouter();
  const token = params.token as string;

  const [winner, setWinner] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [formData, setFormData] = useState({
    recipient_name: '',
    recipient_phone: '',
    shipping_zipcode: '',
    shipping_address: '',
    shipping_address_detail: '',
    shipping_memo: ''
  });
  const [agreed, setAgreed] = useState(false);

  // í† í°ìœ¼ë¡œ ë‹¹ì²¨ì ì •ë³´ ì¡°íšŒ
  useEffect(() => {
    async function loadWinner() {
      try {
        const { data, error } = await supabase
          .from('event_winners')
          .select('*')
          .eq('shipping_token', token)
          .single();

        if (error) throw error;

        // ë§Œë£Œ í™•ì¸
        if (new Date(data.shipping_link_expires_at) < new Date()) {
          alert('ë§í¬ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
          return;
        }

        // ì´ë¯¸ ì…ë ¥ ì™„ë£Œ
        if (data.status === 'shipping_info_received') {
          alert('ì´ë¯¸ ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì…ë ¥í•˜ì…¨ìŠµë‹ˆë‹¤.');
          return;
        }

        setWinner(data);
      } catch (error) {
        console.error('ë‹¹ì²¨ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
        alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤.');
      } finally {
        setIsLoading(false);
      }
    }

    loadWinner();
  }, [token]);

  // ì œì¶œ
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!agreed) {
      alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
      return;
    }

    try {
      // IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸°
      const ipResponse = await fetch('https://api.ipify.org?format=json');
      const { ip } = await ipResponse.json();

      // ë°°ì†¡ì§€ ì •ë³´ ì €ì¥
      const { error } = await supabase
        .from('event_winners')
        .update({
          ...formData,
          status: 'shipping_info_received',
          shipping_consent_at: new Date().toISOString(),
          shipping_consent_ip: ip
        })
        .eq('shipping_token', token);

      if (error) throw error;

      alert('ë°°ì†¡ì§€ ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ê³§ ìƒí’ˆì´ ë°°ì†¡ë  ì˜ˆì •ì…ë‹ˆë‹¤.');
      router.push('/game');
    } catch (error) {
      console.error('ë°°ì†¡ì§€ ì €ì¥ ì‹¤íŒ¨:', error);
      alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  if (isLoading) {
    return <div className="p-8 text-center">ë¡œë”© ì¤‘...</div>;
  }

  if (!winner) {
    return (
      <div className="p-8 text-center">
        <h2 className="text-xl font-bold mb-4">ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤</h2>
        <button
          onClick={() => router.push('/game')}
          className="px-4 py-2 bg-blue-500 text-white rounded"
        >
          ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </button>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-6">ğŸ‰ ë‹¹ì²¨ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤!</h1>

      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <p className="text-sm text-gray-600">ë‹¹ì²¨ ìƒí’ˆ</p>
        <p className="text-lg font-bold">{winner.reward_type}</p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label className="block text-sm font-medium mb-1">
            ë°›ëŠ” ì‚¬ëŒ <span className="text-red-500">*</span>
          </label>
          <input
            type="text"
            value={formData.recipient_name}
            onChange={(e) =>
              setFormData({ ...formData, recipient_name: e.target.value })
            }
            placeholder="í™ê¸¸ë™"
            className="w-full px-3 py-2 border rounded"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-1">
            ì „í™”ë²ˆí˜¸ <span className="text-red-500">*</span>
          </label>
          <input
            type="tel"
            value={formData.recipient_phone}
            onChange={(e) =>
              setFormData({ ...formData, recipient_phone: e.target.value })
            }
            placeholder="010-0000-0000"
            className="w-full px-3 py-2 border rounded"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-1">
            ìš°í¸ë²ˆí˜¸ <span className="text-red-500">*</span>
          </label>
          <div className="flex gap-2">
            <input
              type="text"
              value={formData.shipping_zipcode}
              onChange={(e) =>
                setFormData({ ...formData, shipping_zipcode: e.target.value })
              }
              placeholder="12345"
              className="flex-1 px-3 py-2 border rounded"
              required
            />
            <button
              type="button"
              onClick={() => {
                /* ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API ì—°ë™ */
              }}
              className="px-4 py-2 bg-gray-200 rounded"
            >
              ì£¼ì†Œ ê²€ìƒ‰
            </button>
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-1">
            ì£¼ì†Œ <span className="text-red-500">*</span>
          </label>
          <input
            type="text"
            value={formData.shipping_address}
            onChange={(e) =>
              setFormData({ ...formData, shipping_address: e.target.value })
            }
            placeholder="ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123"
            className="w-full px-3 py-2 border rounded"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-1">
            ìƒì„¸ ì£¼ì†Œ <span className="text-red-500">*</span>
          </label>
          <input
            type="text"
            value={formData.shipping_address_detail}
            onChange={(e) =>
              setFormData({
                ...formData,
                shipping_address_detail: e.target.value
              })
            }
            placeholder="101ë™ 202í˜¸"
            className="w-full px-3 py-2 border rounded"
            required
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-1">
            ë°°ì†¡ ë©”ëª¨ (ì„ íƒ)
          </label>
          <textarea
            value={formData.shipping_memo}
            onChange={(e) =>
              setFormData({ ...formData, shipping_memo: e.target.value })
            }
            placeholder="ì˜ˆ: ë¶€ì¬ ì‹œ ê²½ë¹„ì‹¤ì— ë§¡ê²¨ì£¼ì„¸ìš”"
            className="w-full px-3 py-2 border rounded"
            rows={3}
          />
        </div>

        <div className="bg-gray-50 border rounded p-4">
          <label className="flex items-start text-sm">
            <input
              type="checkbox"
              checked={agreed}
              onChange={(e) => setAgreed(e.target.checked)}
              className="mr-2 mt-1"
              required
            />
            <span>
              <strong>[í•„ìˆ˜]</strong> ìƒí’ˆ ë°°ì†¡ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì—
              ë™ì˜í•©ë‹ˆë‹¤.
              <br />
              <span className="text-xs text-gray-600">
                â€¢ ìˆ˜ì§‘ í•­ëª©: ìˆ˜ë ¹ì¸ëª…, ì „í™”ë²ˆí˜¸, ë°°ì†¡ì§€ ì£¼ì†Œ
                <br />
                â€¢ ìˆ˜ì§‘ ëª©ì : ì´ë²¤íŠ¸ ìƒí’ˆ ë°°ì†¡
                <br />
                â€¢ ë³´ìœ  ê¸°ê°„: ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼
                <br />â€¢ ê±°ë¶€ê¶Œ ë° ë¶ˆì´ìµ: ë™ì˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë‚˜, ìƒí’ˆ ìˆ˜ë ¹ì´
                ë¶ˆê°€í•©ë‹ˆë‹¤.
              </span>
            </span>
          </label>
        </div>

        <div className="flex gap-2">
          <button
            type="button"
            onClick={() => router.push('/game')}
            className="flex-1 px-4 py-3 border rounded"
          >
            ë‚˜ì¤‘ì— ì…ë ¥
          </button>
          <button
            type="submit"
            className="flex-1 px-4 py-3 bg-blue-500 text-white rounded disabled:opacity-50"
            disabled={!agreed}
          >
            ì œì¶œí•˜ê¸°
          </button>
        </div>
      </form>

      <p className="text-xs text-gray-500 mt-4 text-center">
        â€» ë§í¬ ìœ íš¨ê¸°ê°„:{' '}
        {new Date(winner.shipping_link_expires_at).toLocaleDateString()}ê¹Œì§€
      </p>
    </div>
  );
}
```

---

## 5. ê´€ë¦¬ì í˜ì´ì§€

```typescript
// src/app/admin/winners/page.tsx
'use client';

import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabase';

export default function WinnersManagementPage() {
  const [winners, setWinners] = useState<any[]>([]);

  useEffect(() => {
    loadWinners();
  }, []);

  async function loadWinners() {
    const { data } = await supabase
      .from('event_winners')
      .select(`
        *,
        user:user_profiles(name, toss_email, toss_phone)
      `)
      .order('won_at', { ascending: false });

    setWinners(data || []);
  }

  async function sendNotification(winnerId: string) {
    try {
      await fetch('/api/admin/send-winner-notification', {
        method: 'POST',
        body: JSON.stringify({ winnerId })
      });
      alert('ê³ ì§€ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadWinners();
    } catch (error) {
      alert('ë°œì†¡ ì‹¤íŒ¨');
    }
  }

  return (
    <div className="p-8">
      <h1 className="text-2xl font-bold mb-6">ë‹¹ì²¨ì ê´€ë¦¬</h1>

      <table className="w-full border">
        <thead className="bg-gray-100">
          <tr>
            <th className="p-2 border">ì´ë¦„</th>
            <th className="p-2 border">ë‹¹ì²¨ì¼</th>
            <th className="p-2 border">ìƒí’ˆ</th>
            <th className="p-2 border">ìƒíƒœ</th>
            <th className="p-2 border">ì´ë©”ì¼</th>
            <th className="p-2 border">ì „í™”ë²ˆí˜¸</th>
            <th className="p-2 border">ë°°ì†¡ì§€</th>
            <th className="p-2 border">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody>
          {winners.map((winner) => (
            <tr key={winner.id}>
              <td className="p-2 border">{winner.user?.name}</td>
              <td className="p-2 border">
                {new Date(winner.won_at).toLocaleDateString()}
              </td>
              <td className="p-2 border">{winner.reward_type}</td>
              <td className="p-2 border">
                <span
                  className={`px-2 py-1 rounded text-xs ${
                    winner.status === 'pending'
                      ? 'bg-yellow-100'
                      : winner.status === 'notified'
                      ? 'bg-blue-100'
                      : winner.status === 'shipping_info_received'
                      ? 'bg-green-100'
                      : 'bg-gray-100'
                  }`}
                >
                  {winner.status}
                </span>
              </td>
              <td className="p-2 border text-xs">
                {winner.user?.toss_email || '-'}
              </td>
              <td className="p-2 border text-xs">
                {winner.user?.toss_phone || '-'}
              </td>
              <td className="p-2 border text-xs">
                {winner.shipping_address || '-'}
              </td>
              <td className="p-2 border">
                {winner.status === 'pending' && (
                  <button
                    onClick={() => sendNotification(winner.id)}
                    className="px-3 py-1 bg-blue-500 text-white rounded text-sm"
                  >
                    ê³ ì§€ ë°œì†¡
                  </button>
                )}
                {winner.status === 'shipping_info_received' && (
                  <button className="px-3 py-1 bg-green-500 text-white rounded text-sm">
                    ë°°ì†¡ ì²˜ë¦¬
                  </button>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

## 6. ìµœì¢… ì •ë¦¬

### 6.1 í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ í™œìš© ê°€ëŠ¥

| í•­ëª© | ë‚´ìš© |
|------|------|
| **í™œìš© ëª©ì ** | ë‹¹ì²¨ ì•ˆë‚´ ë° ë°°ì†¡ì§€ ì…ë ¥ ë§í¬ ë°œì†¡ |
| **ë²•ì  ê·¼ê±°** | ê³„ì•½ ì´í–‰ì— ë¶ˆê°€í”¼ (ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì œ15ì¡° ì œ1í•­ ì œ4í˜¸) |
| **ì¡°ê±´** | ì´ë²¤íŠ¸ ê·œì •ì— ëª…ì‹œ + ìµœì†Œí•œ ì‚¬ìš© + ì¦‰ì‹œ íê¸° |
| **ì‹¤ì œ ì €ì¥** | âŒ ë°°ì†¡ì§€ ì£¼ì†Œë§Œ ë³„ë„ ìˆ˜ì§‘ ì €ì¥ |

### 6.2 í”„ë¡œì„¸ìŠ¤ ìš”ì•½

```
1. ì´ë²¤íŠ¸ ë‹¬ì„± â†’ event_winners í…Œì´ë¸” ë“±ë¡
2. í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ë¡œ ê³ ì§€ ë°œì†¡ (ë°°ì†¡ì§€ ì…ë ¥ ë§í¬)
3. ì‚¬ìš©ìê°€ ë§í¬ ì ‘ì† â†’ ë°°ì†¡ì§€ ì •ë³´ ë³„ë„ ì…ë ¥
4. ë°°ì†¡ì§€ ì •ë³´ë§Œ DBì— ì €ì¥ (ë³„ë„ ë™ì˜)
5. ë°°ì†¡ ì²˜ë¦¬
6. ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼ ë’¤ ì •ë³´ ìë™ ì‚­ì œ
```

### 6.3 ì¥ì 

âœ… í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ë¥¼ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ (ìµœì†Œ ìˆ˜ì§‘)
âœ… ë°°ì†¡ì§€ ì •ë³´ë§Œ ë³„ë„ ë™ì˜ ë°›ì•„ ì €ì¥
âœ… ì‚¬ìš©ìê°€ ì •í™•í•œ ë°°ì†¡ì§€ ì…ë ¥ ê°€ëŠ¥
âœ… ë²•ì  ë¦¬ìŠ¤í¬ ìµœì†Œí™”
âœ… ê´€ë¦¬ì ë°°ì†¡ ì²˜ë¦¬ í¸ë¦¬

---

## 7. ì²´í¬ë¦¬ìŠ¤íŠ¸

### êµ¬í˜„ í•„ìš” í•­ëª©

```
â–¡ DB ìŠ¤í‚¤ë§ˆ
  â–¡ event_winners í…Œì´ë¸” ìƒì„±
  â–¡ í† í° ìƒì„± ë¡œì§ êµ¬í˜„

â–¡ ê³ ì§€ ë°œì†¡
  â–¡ ì´ë©”ì¼ ë°œì†¡ API (Supabase Edge Function)
  â–¡ SMS ë°œì†¡ API (ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™)
  â–¡ ê´€ë¦¬ì í˜ì´ì§€ (ê³ ì§€ ë°œì†¡ ë²„íŠ¼)

â–¡ ë°°ì†¡ì§€ ì…ë ¥ í˜ì´ì§€
  â–¡ /reward/shipping/[token] í˜ì´ì§€ êµ¬í˜„
  â–¡ ë‹¤ìŒ ìš°í¸ë²ˆí˜¸ API ì—°ë™
  â–¡ ë°°ì†¡ì§€ ì €ì¥ API

â–¡ ì´ë²¤íŠ¸ ê·œì •
  â–¡ ì•½ê´€ì— "ë‹¹ì²¨ ì‹œ ì—°ë½ì²˜ë¡œ ê³ ì§€" ëª…ì‹œ
  â–¡ "ë°°ì†¡ì§€ ì •ë³´ ë³„ë„ ìˆ˜ì§‘" ëª…ì‹œ

â–¡ ìë™í™”
  â–¡ ë§í¬ ë§Œë£Œ ì‹œ ìë™ ì·¨ì†Œ (ë°°ì¹˜ ì‘ì—…)
  â–¡ ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼ ìë™ ì‚­ì œ (ë°°ì¹˜ ì‘ì—…)
```

---

**ë¬¸ì„œ ë²„ì „:** 1.0
**ìµœì¢… ìˆ˜ì •:** 2026-01-04
