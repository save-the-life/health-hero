# π—οΈ ν—¬μ¤ νμ–΄λ΅ μ•„ν‚¤ν…μ²

## π“‹ λ©μ°¨

1. [μ „μ²΄ μ•„ν‚¤ν…μ²](#μ „μ²΄-μ•„ν‚¤ν…μ²)
2. [μ„λ²„λ¦¬μ¤ μ„¤κ³„](#μ„λ²„λ¦¬μ¤-μ„¤κ³„)
3. [λ°μ΄ν„° νλ¦„](#λ°μ΄ν„°-νλ¦„)
4. [λ³΄μ• λ©”μ»¤λ‹μ¦](#λ³΄μ•-λ©”μ»¤λ‹μ¦)
5. [ν™•μ¥ κ°€λ¥μ„±](#ν™•μ¥-κ°€λ¥μ„±)

---

## π― μ „μ²΄ μ•„ν‚¤ν…μ²

### μ„λ²„λ¦¬μ¤ (Serverless) κµ¬μ΅°

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  μ‚¬μ©μ (λΈλΌμ°μ €)                    β”‚
β”‚                                                       β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚         Next.js 15 (Static Export)          β”‚   β”‚
β”‚  β”‚  β€Ά App Router                               β”‚   β”‚
β”‚  β”‚  β€Ά React 19                                 β”‚   β”‚
β”‚  β”‚  β€Ά Zustand (μƒνƒ κ΄€λ¦¬)                       β”‚   β”‚
β”‚  β”‚  β€Ά Phaser 3 (κ²μ„ μ—”μ§„)                     β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
            β”‚                         β”‚
            β”‚ HTTPS                   β”‚ HTTPS
            β”‚                         β”‚
    β”β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”        β”β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”
    β”‚   ν† μ¤ API     β”‚        β”‚  Supabase   β”‚
    β”‚  (μ•±μΈν† μ¤)     β”‚        β”‚             β”‚
    β”‚                β”‚        β”‚ PostgreSQL  β”‚
    β”‚ β€Ά ν† μ¤ λ΅κ·ΈμΈ   β”‚        β”‚ + Auth      β”‚
    β”‚ β€Ά ν† ν° λ°κΈ‰    β”‚        β”‚ + RLS       β”‚
    β”‚ β€Ά μ‚¬μ©μ μ •λ³΄   β”‚        β”‚             β”‚
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”        β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

**νΉμ§•:**
- β… **λ°±μ—”λ“ μ„λ²„ μ—†μ**
- β… ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ™Έλ¶€ API νΈμ¶
- β… Supabaseκ°€ λ°μ΄ν„°λ² μ΄μ¤ + μΈμ¦ + API μ κ³µ
- β… μ™„μ „ν• μ •μ  μ‚¬μ΄νΈ (Static Export)

---

## π¨ μ„λ²„λ¦¬μ¤ μ„¤κ³„

### 1. μΈμ¦ (Authentication)

```
μ‚¬μ©μ
  β”‚
  β”‚ 1. λ΅κ·ΈμΈ λ²„νΌ ν΄λ¦­
  β–Ό
appLogin() (μ•±μΈν† μ¤ SDK)
  β”‚
  β”‚ 2. authorizationCode λ°ν™
  β–Ό
fetch('ν† μ¤ API') β† ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ νΈμ¶!
  β”‚
  β”‚ 3. accessToken λ°ν™
  β–Ό
supabase.auth.signUp() β† ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ νΈμ¶!
  β”‚
  β”‚ 4. Supabase μ„Έμ… μƒμ„±
  β–Ό
user_profiles ν…μ΄λΈ”μ— μ €μ¥ (RLSλ΅ λ³΄νΈ)
```

**ν¬μΈνΈ:**
- λ¨λ“  λ‹¨κ³„κ°€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‹¤ν–‰
- μ„λ²„ λ¶ν•„μ”
- Client Secret λ¶ν•„μ”

### 2. λ°μ΄ν„° μ €μ¥ (Database)

```
μ‚¬μ©μ μ•΅μ… (μ μ νλ“, λ λ²¨μ—… λ“±)
  β”‚
  β”‚ ν΄λΌμ΄μ–ΈνΈμ—μ„ κ³„μ‚°
  β–Ό
supabase.from('user_profiles').update(...)
  β”‚
  β”‚ RLS μ •μ±… μλ™ μ μ©
  β–Ό
PostgreSQL (Supabase)
```

**λ³΄μ•:**
```sql
-- μ‚¬μ©μλ” μμ‹ μ λ°μ΄ν„°λ§ μμ • κ°€λ¥
CREATE POLICY "Users can update own profile"
  ON user_profiles
  FOR UPDATE
  USING (auth.uid() = id);
```

### 3. κ΄‘κ³  (Advertising)

```
ν•νΈ 0 β†’ μ»¨ν‹°λ‰΄ λ¨λ‹¬
  β”‚
  β”‚ "κ΄‘κ³  λ³΄κ³  κ³„μ†ν•κΈ°" ν΄λ¦­
  β–Ό
μ•±μΈν† μ¤ κ΄‘κ³  SDK / AdMob SDK
  β”‚
  β”‚ κ΄‘κ³  μ‹μ²­ μ™„λ£
  β–Ό
ν΄λΌμ΄μ–ΈνΈμ—μ„ λ³΄μƒ μ²λ¦¬
  β”‚
  β”‚ hearts++
  β–Ό
supabase.from('ad_rewards').insert(...)
  β”‚
  β”‚ RLSλ΅ μ΅°μ‘ λ°©μ§€
  β–Ό
κ²μ„ μ¬κ°
```

**νΉμ§•:**
- SDKλ§μΌλ΅ κ΄‘κ³  ν‘μ‹
- μ„λ²„ κ²€μ¦ λ¶ν•„μ” (RLSλ΅ λ€μ²΄)
- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ™„κ²°

---

## π”„ λ°μ΄ν„° νλ¦„

### λ΅κ·ΈμΈ ν”λ΅μ°

```mermaid
sequenceDiagram
    participant U as μ‚¬μ©μ
    participant C as ν΄λΌμ΄μ–ΈνΈ
    participant T as ν† μ¤ API
    participant S as Supabase

    U->>C: λ΅κ·ΈμΈ λ²„νΌ ν΄λ¦­
    C->>T: appLogin() β†’ authorizationCode
    C->>T: generate-token β†’ accessToken
    C->>T: user μ •λ³΄ μ΅°ν β†’ name
    C->>S: signUp/signIn
    C->>S: user_profiles upsert
    S->>C: μ„Έμ… λ°ν™
    C->>U: /game νμ΄μ§€λ΅ μ΄λ™
```

### κ²μ„ ν”λ μ΄ ν”λ΅μ°

```mermaid
sequenceDiagram
    participant U as μ‚¬μ©μ
    participant C as ν΄λΌμ΄μ–ΈνΈ
    participant S as Supabase

    U->>C: ν€΄μ¦ μ •λ‹µ μ μ¶
    C->>C: μ •λ‹µ ν™•μΈ (ν΄λΌμ΄μ–ΈνΈ)
    C->>C: μ μ κ³„μ‚°
    C->>S: user_profiles.update(score)
    S->>S: RLS μ •μ±… ν™•μΈ
    S->>C: μ—…λ°μ΄νΈ μ„±κ³µ
    C->>U: κ²°κ³Ό ν‘μ‹
```

### κ΄‘κ³  λ³΄μƒ ν”λ΅μ°

```mermaid
sequenceDiagram
    participant U as μ‚¬μ©μ
    participant C as ν΄λΌμ΄μ–ΈνΈ
    participant A as κ΄‘κ³  SDK
    participant S as Supabase

    U->>C: κ΄‘κ³  λ³΄κ³  κ³„μ†ν•κΈ°
    C->>A: showRewardedAd()
    A->>U: κ΄‘κ³  ν‘μ‹
    U->>A: κ΄‘κ³  μ‹μ²­ μ™„λ£
    A->>C: rewarded = true
    C->>C: hearts++
    C->>S: ad_rewards.insert()
    S->>S: RLS: μ‚½μ…λ§ κ°€λ¥
    C->>U: κ²μ„ μ¬κ°
```

---

## π›΅οΈ λ³΄μ• λ©”μ»¤λ‹μ¦

### 1. ν† μ¤ λ΅κ·ΈμΈ λ³΄μ•

**κ³„μΈµμ  λ³΄μ•:**
1. **μ•±μΈν† μ¤ μ½μ†” λ“±λ΅** - λ“±λ΅λ μ•±λ§ SDK μ‚¬μ©
2. **ν† μ¤μ•± λ‚΄λ¶€ μ‹¤ν–‰** - μΌλ° λΈλΌμ°μ €μ—μ„ νΈμ¶ λ¶κ°€
3. **μΈκ°€ μ½”λ“ μ ν•** - 10λ¶„ μ ν¨, 1νμ©
4. **ν† ν° λ§λ£** - AccessToken 1μ‹κ°„ ν›„ λ§λ£

**κ²°κ³Ό:**
- Client Secret λ¶ν•„μ”
- mTLS λ¶ν•„μ” (κΈ°λ³Έ κΈ°λ¥)
- μ¶©λ¶„ν μ•μ „

### 2. Supabase Row Level Security (RLS)

```sql
-- μμ‹ 1: μ½κΈ° μ ν•
CREATE POLICY "Users can view own profile"
  ON user_profiles
  FOR SELECT
  USING (auth.uid() = id);

-- μμ‹ 2: μ“°κΈ° μ ν•
CREATE POLICY "Users can update own profile"
  ON user_profiles
  FOR UPDATE
  USING (auth.uid() = id);

-- μμ‹ 3: κ΄‘κ³  μ΅°μ‘ λ°©μ§€
CREATE POLICY "Users can insert own ad rewards"
  ON ad_rewards
  FOR INSERT
  WITH CHECK (auth.uid() = user_id);

-- μμ •/μ‚­μ  λ¶κ°€
CREATE POLICY "No updates allowed"
  ON ad_rewards
  FOR UPDATE
  USING (false);
```

**ν¨κ³Ό:**
- β… μ‚¬μ©μ Aλ” μ‚¬μ©μ B λ°μ΄ν„° μ ‘κ·Ό λ¶κ°€
- β… μ μ μ΅°μ‘ λ¶κ°€
- β… κ΄‘κ³  λ³΄μƒ μ¤‘λ³µ λ¶κ°€
- β… anon key λ…Έμ¶λμ–΄λ„ μ•μ „

### 3. ν΄λΌμ΄μ–ΈνΈ κ²€μ¦

```typescript
// ν΄λΌμ΄μ–ΈνΈμ—μ„ κΈ°λ³Έ κ²€μ¦
const validateAnswer = (answer: string, correct: string) => {
  return answer === correct
}

// Supabaseμ— μ €μ¥ (RLSκ°€ μ¶”κ°€ λ³΄μ•)
await supabase
  .from('user_profiles')
  .update({ score: score + 10 })
  .eq('id', user.id)
```

**ν•κ³„:**
- β οΈ ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ” μ΅°μ‘ κ°€λ¥
- β οΈ μ¤‘μ”ν• κ²€μ¦μ€ λ―Έλμ— μ„λ²„ ν•„μ”

**ν„μ¬ λ€μ‘:**
- RLSλ΅ μµμ† λ³΄μ• μ μ§€
- κ²μ„μ€ κ²½μλ³΄λ‹¤ ν•™μµ μ¤‘μ‹¬
- λ¦¬λ”λ³΄λ“λ” μ°Έκ³ μ©

---

## π€ ν™•μ¥ κ°€λ¥μ„±

### Phase 1: ν„μ¬ (μ„λ²„λ¦¬μ¤) β…

```
κµ¬μ΅°: ν΄λΌμ΄μ–ΈνΈ β†’ μ™Έλ¶€ API

κ°€λ¥:
β… ν† μ¤ λ΅κ·ΈμΈ
β… κ²μ„ ν”λ μ΄
β… λ°μ΄ν„° μ €μ¥
β… κ΄‘κ³  (ν•νΈ μ¶©μ „)
β… λ¦¬λ”λ³΄λ“

λΉ„μ©: $0/μ›”
```

### Phase 2: λ―Έλ (ν•μ΄λΈλ¦¬λ“)

```
κµ¬μ΅°: ν΄λΌμ΄μ–ΈνΈ β†’ Next.js API Routes β†’ μ™Έλ¶€ API

μ¶”κ°€:
β… ν† μ¤ νμ΄ κ²°μ 
β… μΈμ•± κ²°μ 
β… ν‘Έμ‹ μ•λ¦Ό
β… μ •κµν• λ¶€μ • λ°©μ§€

ν•„μ”:
β οΈ mTLS μΈμ¦μ„
β οΈ API Routes κµ¬ν„
β οΈ μ„λ²„ λ°°ν¬

λΉ„μ©: $20/μ›” (Vercel Pro)
```

### Phase 3: μ™„μ „ μ„λ²„ (μ„ νƒ)

```
κµ¬μ΅°: ν΄λΌμ΄μ–ΈνΈ β†’ μ „μ© λ°±μ—”λ“ β†’ μ™Έλ¶€ API

μ¶”κ°€:
β… μ‹¤μ‹κ°„ λ©€ν‹°ν”λ μ΄
β… κ΄€λ¦¬μ λ€μ‹λ³΄λ“
β… κ³ κΈ‰ λ¶„μ„
β… μ™„λ²½ν• λ³΄μ•

ν•„μ”:
β οΈ Node.js μ„λ²„
β οΈ λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…
β οΈ μΈν”„λΌ κ΄€λ¦¬

λΉ„μ©: $50+/μ›”
```

---

## π“ κΈ°μ  μ¤νƒ

### Frontend
```
- Framework: Next.js 15.5.5
- Runtime: React 19
- Language: TypeScript
- State: Zustand 5.0.8
- Styling: Tailwind CSS 4
- Game: Phaser 3.90.0
- Animation: Framer Motion
```

### Backend (μ„λ²„λ¦¬μ¤)
```
- Database: Supabase PostgreSQL
- Auth: Supabase Auth
- API: Supabase REST API
- Storage: Supabase Storage (λ―Έλ)
```

### External APIs
```
- Login: μ•±μΈν† μ¤ (ν† μ¤)
- Ads: μ•±μΈν† μ¤/AdMob
```

### Deployment
```
- Frontend: Vercel (Static)
- Backend: Supabase
- CDN: Vercel Edge Network
```

---

## π― μ„¤κ³„ μ›μΉ™

### 1. μ„λ²„λ¦¬μ¤ μ°μ„ 
- κ°€λ¥ν• ν• μ„λ²„ μ—†μ΄ κµ¬ν„
- λΉ„μ© μµμ†ν™”
- κ΄€λ¦¬ λ¶€λ‹΄ μµμ†ν™”

### 2. μ μ§„μ  ν™•μ¥
- ν•„μ”ν•  λ• μ„λ²„ μ¶”κ°€
- κΈ°μ΅΄ μ½”λ“ μ μ§€
- λ‹¨κ³„μ  λ§μ΄κ·Έλ μ΄μ…

### 3. λ³΄μ• μ°μ„ 
- RLSλ΅ λ°μ΄ν„° λ³΄νΈ
- ν΄λΌμ΄μ–ΈνΈ κ²€μ¦ + μ„λ²„ κ²€μ¦
- λ―Όκ°ν• λ°μ΄ν„°λ” μ„λ²„ μ²λ¦¬

### 4. μ‚¬μ©μ κ²½ν—
- λΉ λ¥Έ λ΅λ”©
- μ¤ν”„λΌμΈ μ§€μ› (PWA)
- λ°μ‘ν• λ””μμΈ

---

## π“ μ°Έκ³  λ¬Έμ„

- [README_TOSS_LOGIN.md](../README_TOSS_LOGIN.md) - ν† μ¤ λ΅κ·ΈμΈ κ°μ”
- [TOSS_LOGIN_SETUP.md](./TOSS_LOGIN_SETUP.md) - μ„¤μ • κ°€μ΄λ“
- [SECURITY_FAQ.md](./SECURITY_FAQ.md) - λ³΄μ• FAQ
- [MTLS_GUIDE.md](./MTLS_GUIDE.md) - λ―Έλ ν™•μ¥ κ°€μ΄λ“
- [PROJECT.md](./PROJECT.md) - ν”„λ΅μ νΈ μ „μ²΄ κµ¬μ΅°

---

**Last Updated**: 2024-01-20  
**Architecture**: Serverless (Supabase + ν΄λΌμ΄μ–ΈνΈ)  
**Status**: Production Ready β…

