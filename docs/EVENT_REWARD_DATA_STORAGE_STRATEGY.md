# ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬ì„ ìœ„í•œ ì‚¬ìš©ì ì •ë³´ ì €ì¥ ì „ëµ

**ëª©ì :** ì‚¬ìš©ìê°€ íŠ¹ì • ì´ë²¤íŠ¸ë¥¼ ì„±ê³µí•˜ë©´ ìƒí’ˆ(ê²½í’ˆ)ì„ ì „ë‹¬í•˜ê¸° ìœ„í•´ ì´ë©”ì¼/íœ´ëŒ€ì „í™” ì •ë³´ë¥¼ ìˆ˜ì§‘
**ë¶„ì„ ì¼ì:** 2026-01-04
**ìµœì¢… ì—…ë°ì´íŠ¸:** 2026-01-04

---

## ğŸ¯ ìµœì¢… ê²°ë¡  (ì—…ë°ì´íŠ¸)

### ìƒí’ˆ ìœ í˜•ë³„ ê¶Œì¥ ì „ëµ

| ìƒí’ˆ ìœ í˜• | í•„ìš” ì •ë³´ | í† ìŠ¤ ì •ë³´ í™œìš© | ê¶Œì¥ ë°©ì‹ |
|-----------|-----------|----------------|-----------|
| **ë””ì§€í„¸ ìƒí’ˆ** (ì¿ í°, í¬ì¸íŠ¸) | ì´ë©”ì¼/ì „í™” | ğŸŸ¡ ì‹ ì¤‘íˆ | ë³„ë„ ìˆ˜ì§‘ ê¶Œì¥ |
| **ë¬¼ë¦¬ì  ìƒí’ˆ** (ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜) | ë°°ì†¡ì§€ ì£¼ì†Œ | âœ… **ì ê·¹ í™œìš©** | **ë§í¬ ë°œì†¡ ë°©ì‹ (ë² ìŠ¤íŠ¸)** |

### ğŸŒŸ ë¬¼ë¦¬ì  ìƒí’ˆì˜ ê²½ìš°: ë§í¬ ë°œì†¡ ë°©ì‹ì´ ë² ìŠ¤íŠ¸!

```
1. ì´ë²¤íŠ¸ ë‹¬ì„± â†’ "ë°°ì†¡ì§€ ì…ë ¥ ì•ˆë‚´ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤" ëª¨ë‹¬
2. í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë¡œ ë§í¬ ë°œì†¡ (DB ì €ì¥ ì•ˆí•¨)
3. ì‚¬ìš©ìê°€ ë§í¬ í´ë¦­ â†’ ë°°ì†¡ì§€ë§Œ ë³„ë„ ì…ë ¥
4. ë°°ì†¡ ì²˜ë¦¬
5. ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼ ë’¤ ì •ë³´ ìë™ ì‚­ì œ
```

**ì¥ì :**
- âœ… í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë¥¼ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ (ìµœì†Œ ìˆ˜ì§‘)
- âœ… ê³„ì•½ ì´í–‰ ëª©ì ìœ¼ë¡œ í™œìš© ê°€ëŠ¥ (ë²•ì  ì•ˆì •ì„±)
- âœ… ë°°ì†¡ì§€ë§Œ ë³„ë„ ë™ì˜ ë°›ì•„ ì €ì¥
- âœ… ì‚¬ìš©ìê°€ ì •í™•í•œ ë°°ì†¡ì§€ ì§ì ‘ ì…ë ¥
- âœ… ì¼íšŒìš© í† í° ë§í¬ë¡œ ë³´ì•ˆ ê°•í™”

---

## 1. ê°œì¸ì •ë³´ ë³´í˜¸ë²• ê´€ì 

### 1.1 ê°œì¸ì •ë³´ ìˆ˜ì§‘ ì›ì¹™

**ê°œì¸ì •ë³´ ë³´í˜¸ë²• ì œ15ì¡° (ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©)**
```
ê°œì¸ì •ë³´ì²˜ë¦¬ìëŠ” ë‹¤ìŒ ê° í˜¸ì˜ ì–´ëŠ í•˜ë‚˜ì— í•´ë‹¹í•˜ëŠ” ê²½ìš°ì—ëŠ”
ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆìœ¼ë©° ê·¸ ìˆ˜ì§‘ ëª©ì ì˜ ë²”ìœ„ì—ì„œ ì´ìš©í•  ìˆ˜ ìˆë‹¤.

1. ì •ë³´ì£¼ì²´ì˜ ë™ì˜ë¥¼ ë°›ì€ ê²½ìš°
2. ë²•ë¥ ì— íŠ¹ë³„í•œ ê·œì •ì´ ìˆê±°ë‚˜ ë²•ë ¹ìƒ ì˜ë¬´ë¥¼ ì¤€ìˆ˜í•˜ê¸° ìœ„í•˜ì—¬ ë¶ˆê°€í”¼í•œ ê²½ìš°
3. ê³µê³µê¸°ê´€ì´ ë²•ë ¹ ë“±ì—ì„œ ì •í•˜ëŠ” ì†Œê´€ ì—…ë¬´ì˜ ìˆ˜í–‰ì„ ìœ„í•˜ì—¬ ë¶ˆê°€í”¼í•œ ê²½ìš°
4. ì •ë³´ì£¼ì²´ì™€ì˜ ê³„ì•½ì˜ ì²´ê²° ë° ì´í–‰ì„ ìœ„í•˜ì—¬ ë¶ˆê°€í”¼í•˜ê²Œ í•„ìš”í•œ ê²½ìš°
```

### 1.2 ëª©ì  ì™¸ ì‚¬ìš© ê¸ˆì§€

**í•µì‹¬ ì›ì¹™:**
- ìˆ˜ì§‘ ì‹œ ëª…ì‹œí•œ **ëª©ì  ë²”ìœ„ ë‚´**ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥
- ëª©ì ì´ ë³€ê²½ë˜ë©´ **ì¬ë™ì˜** í•„ìš”

**í† ìŠ¤ ë¡œê·¸ì¸ ì•½ê´€ ì˜ˆì‹œ:**
```
[ì œ3ì ì •ë³´ ì œê³µ ë™ì˜]
- ì œê³µë°›ëŠ” ì: Health Hero (í—¬ìŠ¤ íˆì–´ë¡œ)
- ì œê³µ ëª©ì : ì„œë¹„ìŠ¤ ì´ìš©, ë³¸ì¸ í™•ì¸
- ì œê³µ í•­ëª©: ì´ë¦„, ì´ë©”ì¼
```

â†’ **"ì´ë²¤íŠ¸ ìƒí’ˆ ë°°ì†¡"ì€ ëª…ì‹œë˜ì§€ ì•ŠìŒ** âš ï¸

---

## 2. ë¬¸ì œì  ë¶„ì„

### 2.1 í† ìŠ¤ ë¡œê·¸ì¸ ì •ë³´ í™œìš© ì‹œ ë¬¸ì œ

| ë¬¸ì œ | ì„¤ëª… | ë²•ì  ë¦¬ìŠ¤í¬ |
|------|------|------------|
| **ëª©ì  ì™¸ ì‚¬ìš©** | ë¡œê·¸ì¸ ëª©ì  â‰  ìƒí’ˆ ë°°ì†¡ ëª©ì  | ğŸ”´ ë†’ìŒ |
| **ë™ì˜ ë²”ìœ„ ì´ˆê³¼** | í† ìŠ¤ ë™ì˜ëŠ” "ì„œë¹„ìŠ¤ ì´ìš©"ìš© | ğŸ”´ ë†’ìŒ |
| **ì •ë³´ ì •í™•ì„±** | í† ìŠ¤ ì´ë©”ì¼ì€ ì ìœ  ì¸ì¦ ì•ˆë¨ | ğŸŸ¡ ì¤‘ê°„ |
| **ë°°ì†¡ ë¶ˆê°€ ì‹œ** | ì‚¬ìš©ìì—ê²Œ ì¶”ê°€ ì •ë³´ ìš”ì²­ ë¶ˆê°€ | ğŸŸ¡ ì¤‘ê°„ |

**ì˜ˆì‹œ ì‹œë‚˜ë¦¬ì˜¤:**
```
1. ì‚¬ìš©ìê°€ í† ìŠ¤ ë¡œê·¸ì¸ ì‹œ ì´ë©”ì¼ ë™ì˜ (ëª©ì : ì„œë¹„ìŠ¤ ì´ìš©)
2. ì´ë²¤íŠ¸ ë‹¬ì„± í›„ í† ìŠ¤ ì´ë©”ì¼ë¡œ ìƒí’ˆ ë°œì†¡
3. ì‚¬ìš©ì: "ë‚˜ëŠ” ìƒí’ˆ ë°°ì†¡ ë™ì˜ ì•ˆí–ˆëŠ”ë°?" â† ë¯¼ì› ë°œìƒ
4. ë²•ì  ë¶„ìŸ ê°€ëŠ¥ì„± âš ï¸
```

### 2.2 í† ìŠ¤ ì´ë©”ì¼ì˜ íŠ¹ìˆ˜ì„±

**ê³µì‹ ë¬¸ì„œ ê²½ê³ :**
> ì´ë©”ì¼ì€ í† ìŠ¤ ê°€ì… ì‹œ í•„ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ **ê°’ì´ ì—†ì„ ìˆ˜ ìˆìŒ (null ë°˜í™˜)**
> **ì ìœ  ì¸ì¦ì„ í•˜ì§€ ì•Šì€ ê°’ì„**

**ë¬¸ì œì :**
```typescript
// í† ìŠ¤ì—ì„œ ë°›ì€ ì´ë©”ì¼
toss_email: "user@example.com"

// í•˜ì§€ë§Œ...
1. ì‹¤ì œ ì†Œìœ  ì—¬ë¶€ í™•ì¸ ì•ˆë¨ (ì ìœ  ì¸ì¦ X)
2. ì˜¤íƒ€ ê°€ëŠ¥ì„± (ê°€ì… ì‹œ ì§ì ‘ ì…ë ¥)
3. nullì¼ ìˆ˜ ìˆìŒ
```

â†’ **ìƒí’ˆ ë°°ì†¡ìš©ìœ¼ë¡œ ë¶€ì í•©** âš ï¸

---

## 3. ê¶Œì¥ ì €ì¥ ë°©ì‹

> **âš ï¸ ì¤‘ìš” ì—…ë°ì´íŠ¸:**
> ë¬¼ë¦¬ì  ìƒí’ˆ(ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ ë“±)ì˜ ê²½ìš°, **"ë§í¬ ë°œì†¡ ë°©ì‹"**ì´ ë² ìŠ¤íŠ¸ì…ë‹ˆë‹¤.
> ìƒì„¸ ë‚´ìš©ì€ [PHYSICAL_REWARD_DELIVERY_STRATEGY.md](PHYSICAL_REWARD_DELIVERY_STRATEGY.md) ì°¸ê³ 

### 3.1 ë¬¼ë¦¬ì  ìƒí’ˆ: ë§í¬ ë°œì†¡ ë°©ì‹ (ë² ìŠ¤íŠ¸) â­

**event_winners í…Œì´ë¸” ì‚¬ìš©**

```sql
CREATE TABLE event_winners (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,

  -- ì´ë²¤íŠ¸ ì •ë³´
  event_id TEXT NOT NULL,
  event_name TEXT NOT NULL,
  reward_type TEXT NOT NULL,

  -- ë‹¹ì²¨ ì •ë³´
  won_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  notification_sent_at TIMESTAMP WITH TIME ZONE,

  -- ë°°ì†¡ì§€ ì…ë ¥ ë§í¬
  shipping_token TEXT UNIQUE,
  shipping_link_expires_at TIMESTAMP WITH TIME ZONE,

  -- ë°°ì†¡ ì •ë³´ (ì‚¬ìš©ìê°€ ë³„ë„ ì…ë ¥) â¬…ï¸ ì´ê²ƒë§Œ ì €ì¥
  recipient_name TEXT,
  recipient_phone TEXT,
  shipping_address TEXT,
  shipping_zipcode TEXT,

  -- ë°°ì†¡ì§€ ì…ë ¥ ë™ì˜
  shipping_consent_at TIMESTAMP WITH TIME ZONE,
  shipping_consent_ip INET,

  -- ë°°ì†¡ ìƒíƒœ
  status TEXT DEFAULT 'pending',

  UNIQUE(user_id, event_id)
);
```

**í•µì‹¬:**
- âŒ í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ëŠ” DBì— ì €ì¥ ì•ˆí•¨
- âœ… ë°°ì†¡ì§€ ì£¼ì†Œë§Œ ë³„ë„ ë™ì˜ ë°›ì•„ ì €ì¥
- âœ… ì¼íšŒìš© í† í° ë§í¬ë¡œ ë³´ì•ˆ ê°•í™”

### 3.2 ë””ì§€í„¸ ìƒí’ˆ: ë³„ë„ í…Œì´ë¸” ìƒì„± (ê°•ë ¥ ê¶Œì¥)

**ìƒˆ í…Œì´ë¸”: `event_reward_contacts`**

```sql
-- ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬ìš© ì—°ë½ì²˜ í…Œì´ë¸”
CREATE TABLE event_reward_contacts (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,

  -- ì—°ë½ ì •ë³´
  contact_type TEXT NOT NULL CHECK (contact_type IN ('email', 'phone')),
  contact_value TEXT NOT NULL,
  is_verified BOOLEAN DEFAULT false,           -- ì¸ì¦ ì—¬ë¶€

  -- ìˆ˜ì§‘ ë™ì˜ ì •ë³´
  consent_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  consent_purpose TEXT DEFAULT 'event_reward_delivery',  -- ìˆ˜ì§‘ ëª©ì 
  consent_ip INET,                             -- ë™ì˜í•œ IP
  consent_user_agent TEXT,                     -- ë™ì˜í•œ í™˜ê²½

  -- ì´ë²¤íŠ¸ ì •ë³´
  event_id TEXT,                               -- ì–´ë–¤ ì´ë²¤íŠ¸ì¸ì§€
  event_name TEXT,                             -- ì´ë²¤íŠ¸ëª…

  -- ìƒí’ˆ ë°°ì†¡ ì •ë³´
  reward_status TEXT DEFAULT 'pending' CHECK (reward_status IN (
    'pending',      -- ëŒ€ê¸° ì¤‘
    'processing',   -- ì²˜ë¦¬ ì¤‘
    'delivered',    -- ì „ë‹¬ ì™„ë£Œ
    'failed'        -- ì‹¤íŒ¨
  )),
  reward_type TEXT,                            -- ìƒí’ˆ ì¢…ë¥˜
  reward_delivered_at TIMESTAMP WITH TIME ZONE,
  delivery_note TEXT,                          -- ë°°ì†¡ ë©”ëª¨

  -- ê°ì‚¬ ë¡œê·¸
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  -- ìœ ë‹ˆí¬ ì œì•½ (ì¤‘ë³µ ë°©ì§€)
  UNIQUE(user_id, event_id)
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_event_reward_contacts_user_id ON event_reward_contacts(user_id);
CREATE INDEX idx_event_reward_contacts_event_id ON event_reward_contacts(event_id);
CREATE INDEX idx_event_reward_contacts_status ON event_reward_contacts(reward_status);

-- RLS ì •ì±…
ALTER TABLE event_reward_contacts ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own contacts" ON event_reward_contacts
  FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "Users can insert own contacts" ON event_reward_contacts
  FOR INSERT WITH CHECK (auth.uid() = user_id);
```

### 3.2 UI íë¦„ (ë³„ë„ ìˆ˜ì§‘)

```
[ì‚¬ìš©ìê°€ ì´ë²¤íŠ¸ ë‹¬ì„±]
   â†“
[ì¶•í•˜ ë©”ì‹œì§€ í‘œì‹œ]
"ğŸ‰ ì´ë²¤íŠ¸ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤!"
   â†“
[ìƒí’ˆ ìˆ˜ë ¹ ëª¨ë‹¬]
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ìƒí’ˆ ìˆ˜ë ¹ì„ ìœ„í•œ ì •ë³´ ì…ë ¥

  ìƒí’ˆ: [ê²½í’ˆëª…]

  â˜ ì´ë©”ì¼ë¡œ ë°›ê¸°
    ğŸ“§ ì´ë©”ì¼: [          ]
    [ì¸ì¦ë²ˆí˜¸ ë°›ê¸°] ë²„íŠ¼
    ì¸ì¦ë²ˆí˜¸: [      ]

  â˜ íœ´ëŒ€ì „í™”ë¡œ ë°›ê¸°
    ğŸ“± ì „í™”ë²ˆí˜¸: [          ]
    [ì¸ì¦ë²ˆí˜¸ ë°›ê¸°] ë²„íŠ¼
    ì¸ì¦ë²ˆí˜¸: [      ]

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  â˜‘ [í•„ìˆ˜] ìƒí’ˆ ì „ë‹¬ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜
      (ìˆ˜ì§‘ í•­ëª©: ì´ë©”ì¼ ë˜ëŠ” íœ´ëŒ€ì „í™”ë²ˆí˜¸)
      (ìˆ˜ì§‘ ëª©ì : ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬)
      (ë³´ìœ  ê¸°ê°„: ì „ë‹¬ ì™„ë£Œ í›„ 30ì¼)
      [ìƒì„¸ ë³´ê¸°]

  [ì œì¶œí•˜ê¸°] ë²„íŠ¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 3.3 ì¸ì¦ í”„ë¡œì„¸ìŠ¤

**ì´ë©”ì¼ ì¸ì¦:**
```typescript
// 1. ì¸ì¦ë²ˆí˜¸ ë°œì†¡ API
async function sendEmailVerification(email: string, userId: string) {
  const verificationCode = generateRandomCode(6); // 6ìë¦¬ ìˆ«ì

  // Supabase Edge Functionìœ¼ë¡œ ì´ë©”ì¼ ë°œì†¡
  await fetch(`${SUPABASE_URL}/functions/v1/send-verification-email`, {
    method: 'POST',
    body: JSON.stringify({
      email,
      code: verificationCode,
      userId
    })
  });

  // ì¸ì¦ë²ˆí˜¸ ì„ì‹œ ì €ì¥ (5ë¶„ ìœ íš¨)
  await supabase.from('email_verifications').insert({
    user_id: userId,
    email,
    code: verificationCode,
    expires_at: new Date(Date.now() + 5 * 60 * 1000)
  });
}

// 2. ì¸ì¦ë²ˆí˜¸ í™•ì¸ API
async function verifyEmailCode(email: string, code: string, userId: string) {
  const { data } = await supabase
    .from('email_verifications')
    .select('*')
    .eq('user_id', userId)
    .eq('email', email)
    .eq('code', code)
    .gte('expires_at', new Date().toISOString())
    .single();

  if (!data) {
    throw new Error('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ì¸ì¦ ì™„ë£Œ ì²˜ë¦¬
  return true;
}
```

**íœ´ëŒ€ì „í™” ì¸ì¦:**
```typescript
// SMS ì¸ì¦ (ì™¸ë¶€ ì„œë¹„ìŠ¤ í™œìš©)
// ì˜ˆ: NHN Cloud SMS, ì•Œë¦¬ê³ , ì¹´ì¹´ì˜¤í†¡ ì•Œë¦¼í†¡ ë“±
async function sendSmsVerification(phone: string, userId: string) {
  const verificationCode = generateRandomCode(6);

  // SMS ë°œì†¡ API í˜¸ì¶œ
  await smsService.send({
    to: phone,
    message: `[í—¬ìŠ¤íˆì–´ë¡œ] ì¸ì¦ë²ˆí˜¸: ${verificationCode}`
  });

  // ì¸ì¦ë²ˆí˜¸ ì €ì¥
  await supabase.from('phone_verifications').insert({
    user_id: userId,
    phone,
    code: verificationCode,
    expires_at: new Date(Date.now() + 5 * 60 * 1000)
  });
}
```

---

## 4. í† ìŠ¤ ì´ë©”ì¼ í™œìš© ë°©ì‹ (ì°¨ì„ ì±…)

**í† ìŠ¤ ì´ë©”ì¼ì„ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©:**

```typescript
// 1. ì´ë²¤íŠ¸ ë‹¬ì„± ì‹œ ëª¨ë‹¬ í‘œì‹œ
function showRewardModal(user: UserProfile) {
  // í† ìŠ¤ ì´ë©”ì¼ì´ ìˆìœ¼ë©´ ë¯¸ë¦¬ ì±„ì›Œë†“ê¸° (í¸ì˜ì„±)
  const suggestedEmail = user.toss_email || '';

  return (
    <RewardModal>
      <input
        type="email"
        defaultValue={suggestedEmail}  // ë¯¸ë¦¬ ì±„ì›Œë†“ì§€ë§Œ
        placeholder="ìƒí’ˆ ìˆ˜ë ¹ìš© ì´ë©”ì¼"
        required
      />
      <p className="text-xs text-gray-500">
        âš ï¸ í† ìŠ¤ ê°€ì… ì´ë©”ì¼ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        ì •í™•í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.
      </p>

      <label>
        <input type="checkbox" required />
        [í•„ìˆ˜] ìƒí’ˆ ì „ë‹¬ì„ ìœ„í•œ ì´ë©”ì¼ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
      </label>

      <button onClick={() => submitRewardContact()}>
        ì œì¶œí•˜ê¸°
      </button>
    </RewardModal>
  );
}

// 2. ì œì¶œ ì‹œ ë³„ë„ í…Œì´ë¸”ì— ì €ì¥
async function submitRewardContact(
  userId: string,
  email: string,
  eventId: string
) {
  // âœ… event_reward_contacts í…Œì´ë¸”ì— ì €ì¥
  await supabase.from('event_reward_contacts').insert({
    user_id: userId,
    contact_type: 'email',
    contact_value: email,  // ì‚¬ìš©ìê°€ ì…ë ¥/í™•ì¸í•œ ê°’
    event_id: eventId,
    consent_date: new Date().toISOString(),
    consent_purpose: 'event_reward_delivery'
  });
}
```

**ì¥ì :**
- ì‚¬ìš©ì í¸ì˜ì„± í–¥ìƒ (ì´ë©”ì¼ ë¯¸ë¦¬ ì±„ì›Œì§)
- ë³„ë„ ë™ì˜ ë°›ìŒ (ë²•ì  ë¬¸ì œ í•´ê²°)
- ì‚¬ìš©ìê°€ ìˆ˜ì • ê°€ëŠ¥

**ë‹¨ì :**
- ì—¬ì „íˆ ì¸ì¦ í•„ìš” (ì ìœ  í™•ì¸)

---

## 5. ì €ì¥ ë°©ì‹ ë¹„êµí‘œ

| ì €ì¥ ë°©ì‹ | ì¥ì  | ë‹¨ì  | ê¶Œì¥ë„ |
|-----------|------|------|--------|
| **A. user_profilesì— ì €ì¥** | - ê°„í¸í•¨<br>- ì¶”ê°€ í…Œì´ë¸” ë¶ˆí•„ìš” | - ëª©ì  ì™¸ ì‚¬ìš© ìœ„í—˜<br>- ë²•ì  ë¦¬ìŠ¤í¬<br>- ëª©ì ë³„ ê´€ë¦¬ ì–´ë ¤ì›€ | ğŸ”´ ë¹„ê¶Œì¥ |
| **B. ë§í¬ ë°œì†¡ ë°©ì‹ (ë¬¼ë¦¬ì  ìƒí’ˆ)** | - í† ìŠ¤ ì •ë³´ DB ì €ì¥ ì•ˆí•¨<br>- ë²•ì  ì•ˆì •ì„± ìµœê³ <br>- ì‚¬ìš©ì í¸ì˜ì„±<br>- ì •í™•ì„± í™•ë³´ | - ì´ë©”ì¼/SMS ë°œì†¡ í•„ìš”<br>- ë§í¬ í˜ì´ì§€ êµ¬í˜„ | âœ… **ë² ìŠ¤íŠ¸ (ë¬¼ë¦¬ì  ìƒí’ˆ)** |
| **C. ë³„ë„ í…Œì´ë¸” (ë””ì§€í„¸ ìƒí’ˆ)** | - ëª©ì ë³„ ëª…í™•í•œ ë™ì˜<br>- ë²•ì  ì•ˆì •ì„±<br>- ê°ì‚¬ ì¶”ì  ìš©ì´<br>- ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ ëŒ€ì‘ | - ì¶”ê°€ ê°œë°œ í•„ìš”<br>- ì‚¬ìš©ì ì¶”ê°€ ì…ë ¥ | âœ… **ê°•ë ¥ ê¶Œì¥ (ë””ì§€í„¸ ìƒí’ˆ)** |
| **D. í† ìŠ¤ ì´ë©”ì¼ ì°¸ê³  + ë³„ë„ ì €ì¥** | - ì‚¬ìš©ì í¸ì˜ì„±<br>- ë²•ì  ì•ˆì •ì„±<br>- ì •í™•ì„± í™•ë³´ | - ì¤‘ê°„ ìˆ˜ì¤€ ë³µì¡ë„ | ğŸŸ¢ ê¶Œì¥ |

---

## 6. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 6.1 DB êµ¬ì¡°

```sql
-- âœ… ê¶Œì¥: ë³„ë„ í…Œì´ë¸” ìƒì„±
â–¡ event_reward_contacts í…Œì´ë¸” ìƒì„±
â–¡ email_verifications í…Œì´ë¸” ìƒì„± (ì´ë©”ì¼ ì¸ì¦ìš©)
â–¡ phone_verifications í…Œì´ë¸” ìƒì„± (íœ´ëŒ€ì „í™” ì¸ì¦ìš©)

-- âŒ ë¹„ê¶Œì¥: user_profiles í™•ì¥
â–¡ user_profilesì— reward_email, reward_phone ì»¬ëŸ¼ ì¶”ê°€
```

### 6.2 UI/UX

```
â–¡ ì´ë²¤íŠ¸ ë‹¬ì„± ì‹œ ìƒí’ˆ ìˆ˜ë ¹ ëª¨ë‹¬ êµ¬í˜„
â–¡ ì´ë©”ì¼/íœ´ëŒ€ì „í™” ì„ íƒ ì˜µì…˜
â–¡ ì¸ì¦ë²ˆí˜¸ ì…ë ¥ UI
â–¡ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ ì²´í¬ë°•ìŠ¤
â–¡ ì•½ê´€ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬
```

### 6.3 ë°±ì—”ë“œ

```
â–¡ ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ ë°œì†¡ Edge Function
â–¡ SMS ì¸ì¦ë²ˆí˜¸ ë°œì†¡ API ì—°ë™
â–¡ ì¸ì¦ë²ˆí˜¸ í™•ì¸ API
â–¡ ìƒí’ˆ ì „ë‹¬ ì •ë³´ ì €ì¥ API
â–¡ ìƒí’ˆ ë°°ì†¡ ìƒíƒœ ì—…ë°ì´íŠ¸ API
```

### 6.4 ë²•ì  ëŒ€ì‘

```
â–¡ ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ì—…ë°ì´íŠ¸
  - ìˆ˜ì§‘ í•­ëª©: ì´ë©”ì¼ ë˜ëŠ” íœ´ëŒ€ì „í™”ë²ˆí˜¸
  - ìˆ˜ì§‘ ëª©ì : ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬
  - ë³´ìœ  ê¸°ê°„: ì „ë‹¬ ì™„ë£Œ í›„ 30ì¼
â–¡ ì•½ê´€ ë™ì˜ í™”ë©´ êµ¬í˜„
â–¡ ê°ì‚¬ ë¡œê·¸ ì €ì¥ (IP, User-Agent, ë™ì˜ ì‹œê°)
```

---

## 7. ì˜ˆì‹œ ì½”ë“œ

### 7.1 ìƒí’ˆ ìˆ˜ë ¹ ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸

```typescript
// src/components/RewardCollectionModal.tsx
'use client';

import { useState } from 'react';
import { supabase } from '@/lib/supabase';

interface RewardCollectionModalProps {
  userId: string;
  eventId: string;
  eventName: string;
  rewardType: string;
  suggestedEmail?: string; // í† ìŠ¤ ì´ë©”ì¼ (ì°¸ê³ ìš©)
  onClose: () => void;
}

export function RewardCollectionModal({
  userId,
  eventId,
  eventName,
  rewardType,
  suggestedEmail,
  onClose
}: RewardCollectionModalProps) {
  const [contactType, setContactType] = useState<'email' | 'phone'>('email');
  const [contactValue, setContactValue] = useState(suggestedEmail || '');
  const [verificationCode, setVerificationCode] = useState('');
  const [isVerified, setIsVerified] = useState(false);
  const [agreed, setAgreed] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  // ì¸ì¦ë²ˆí˜¸ ë°œì†¡
  const sendVerification = async () => {
    setIsLoading(true);
    try {
      const { error } = await supabase.functions.invoke(
        contactType === 'email' ? 'send-email-verification' : 'send-sms-verification',
        {
          body: {
            userId,
            [contactType]: contactValue
          }
        }
      );

      if (error) throw error;
      alert('ì¸ì¦ë²ˆí˜¸ê°€ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (error) {
      alert('ì¸ì¦ë²ˆí˜¸ ë°œì†¡ ì‹¤íŒ¨');
    } finally {
      setIsLoading(false);
    }
  };

  // ì¸ì¦ë²ˆí˜¸ í™•ì¸
  const verifyCode = async () => {
    setIsLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke('verify-code', {
        body: {
          userId,
          contactType,
          contactValue,
          code: verificationCode
        }
      });

      if (error) throw error;
      if (data.verified) {
        setIsVerified(true);
        alert('ì¸ì¦ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } else {
        alert('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    } catch (error) {
      alert('ì¸ì¦ ì‹¤íŒ¨');
    } finally {
      setIsLoading(false);
    }
  };

  // ì œì¶œ
  const handleSubmit = async () => {
    if (!isVerified) {
      alert('ì¸ì¦ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”.');
      return;
    }

    if (!agreed) {
      alert('ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
      return;
    }

    setIsLoading(true);
    try {
      // event_reward_contacts í…Œì´ë¸”ì— ì €ì¥
      const { error } = await supabase.from('event_reward_contacts').insert({
        user_id: userId,
        contact_type: contactType,
        contact_value: contactValue,
        is_verified: true,
        event_id: eventId,
        event_name: eventName,
        reward_type: rewardType,
        consent_date: new Date().toISOString(),
        consent_purpose: 'event_reward_delivery',
        consent_ip: await fetch('https://api.ipify.org?format=json')
          .then(r => r.json())
          .then(d => d.ip)
          .catch(() => null),
        consent_user_agent: navigator.userAgent
      });

      if (error) throw error;

      alert('ìƒí’ˆ ìˆ˜ë ¹ ì •ë³´ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
      onClose();
    } catch (error) {
      alert('ë“±ë¡ ì‹¤íŒ¨');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h2 className="text-xl font-bold mb-4">ğŸ‰ ìƒí’ˆ ìˆ˜ë ¹ ì •ë³´ ì…ë ¥</h2>

        <div className="mb-4">
          <p className="text-sm text-gray-600 mb-2">
            ì´ë²¤íŠ¸: {eventName}
          </p>
          <p className="text-sm text-gray-600 mb-4">
            ìƒí’ˆ: {rewardType}
          </p>
        </div>

        {/* ì—°ë½ì²˜ íƒ€ì… ì„ íƒ */}
        <div className="mb-4">
          <label className="flex items-center mb-2">
            <input
              type="radio"
              checked={contactType === 'email'}
              onChange={() => setContactType('email')}
              className="mr-2"
            />
            ì´ë©”ì¼ë¡œ ë°›ê¸°
          </label>
          <label className="flex items-center">
            <input
              type="radio"
              checked={contactType === 'phone'}
              onChange={() => setContactType('phone')}
              className="mr-2"
            />
            íœ´ëŒ€ì „í™”ë¡œ ë°›ê¸°
          </label>
        </div>

        {/* ì—°ë½ì²˜ ì…ë ¥ */}
        <div className="mb-4">
          <label className="block text-sm font-medium mb-1">
            {contactType === 'email' ? 'ì´ë©”ì¼' : 'íœ´ëŒ€ì „í™”ë²ˆí˜¸'}
          </label>
          <div className="flex gap-2">
            <input
              type={contactType === 'email' ? 'email' : 'tel'}
              value={contactValue}
              onChange={(e) => setContactValue(e.target.value)}
              placeholder={
                contactType === 'email'
                  ? 'email@example.com'
                  : '010-0000-0000'
              }
              className="flex-1 px-3 py-2 border rounded"
              disabled={isVerified}
            />
            <button
              onClick={sendVerification}
              disabled={isLoading || isVerified || !contactValue}
              className="px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
            >
              {isVerified ? 'ì¸ì¦ì™„ë£Œ' : 'ì¸ì¦ë²ˆí˜¸'}
            </button>
          </div>
          {suggestedEmail && contactType === 'email' && (
            <p className="text-xs text-gray-500 mt-1">
              ğŸ’¡ í† ìŠ¤ ê°€ì… ì´ë©”ì¼: {suggestedEmail}
            </p>
          )}
        </div>

        {/* ì¸ì¦ë²ˆí˜¸ ì…ë ¥ */}
        {!isVerified && (
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">
              ì¸ì¦ë²ˆí˜¸
            </label>
            <div className="flex gap-2">
              <input
                type="text"
                value={verificationCode}
                onChange={(e) => setVerificationCode(e.target.value)}
                placeholder="6ìë¦¬ ìˆ«ì"
                className="flex-1 px-3 py-2 border rounded"
                maxLength={6}
              />
              <button
                onClick={verifyCode}
                disabled={isLoading || !verificationCode}
                className="px-4 py-2 bg-green-500 text-white rounded disabled:opacity-50"
              >
                í™•ì¸
              </button>
            </div>
          </div>
        )}

        {/* ê°œì¸ì •ë³´ ë™ì˜ */}
        <div className="mb-4 p-3 bg-gray-50 rounded">
          <label className="flex items-start text-sm">
            <input
              type="checkbox"
              checked={agreed}
              onChange={(e) => setAgreed(e.target.checked)}
              className="mr-2 mt-1"
              required
            />
            <span>
              [í•„ìˆ˜] ìƒí’ˆ ì „ë‹¬ì„ ìœ„í•œ ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
              <br />
              <span className="text-xs text-gray-600">
                â€¢ ìˆ˜ì§‘ í•­ëª©: {contactType === 'email' ? 'ì´ë©”ì¼' : 'íœ´ëŒ€ì „í™”ë²ˆí˜¸'}
                <br />
                â€¢ ìˆ˜ì§‘ ëª©ì : ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬
                <br />
                â€¢ ë³´ìœ  ê¸°ê°„: ì „ë‹¬ ì™„ë£Œ í›„ 30ì¼
              </span>
            </span>
          </label>
        </div>

        {/* ë²„íŠ¼ */}
        <div className="flex gap-2">
          <button
            onClick={onClose}
            className="flex-1 px-4 py-2 border rounded"
            disabled={isLoading}
          >
            ì·¨ì†Œ
          </button>
          <button
            onClick={handleSubmit}
            disabled={isLoading || !isVerified || !agreed}
            className="flex-1 px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
          >
            {isLoading ? 'ì²˜ë¦¬ì¤‘...' : 'ì œì¶œí•˜ê¸°'}
          </button>
        </div>
      </div>
    </div>
  );
}
```

---

## 8. ìµœì¢… ê¶Œì¥ì‚¬í•­ (ì—…ë°ì´íŠ¸)

### âœ… DO (ê¶Œì¥)

#### ë¬¼ë¦¬ì  ìƒí’ˆ (ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜ ë“±) - ë² ìŠ¤íŠ¸ ë°©ì‹ â­

1. **event_winners í…Œì´ë¸” ìƒì„±** (ë§í¬ ë°œì†¡ ë°©ì‹)
2. **í† ìŠ¤ ì´ë©”ì¼/ì „í™”ë¡œ ë§í¬ ë°œì†¡** (DB ì €ì¥ ì•ˆí•¨)
3. **ë°°ì†¡ì§€ë§Œ ë³„ë„ ìˆ˜ì§‘** (ì‚¬ìš©ìê°€ ë§í¬ì—ì„œ ì…ë ¥)
4. **ì¼íšŒìš© í† í° ì‚¬ìš©** (7ì¼ ë§Œë£Œ)
5. **ë°°ì†¡ ì™„ë£Œ í›„ 30ì¼ ë’¤ ìë™ ì‚­ì œ**

**í•µì‹¬ ì¥ì :**
- í† ìŠ¤ ì •ë³´ë¥¼ DBì— ì €ì¥í•˜ì§€ ì•ŠìŒ (ìµœì†Œ ìˆ˜ì§‘ ì›ì¹™)
- ê³„ì•½ ì´í–‰ ëª©ì ìœ¼ë¡œ í™œìš© ê°€ëŠ¥ (ë²•ì  ì•ˆì •ì„±)
- ì‚¬ìš©ìê°€ ì •í™•í•œ ë°°ì†¡ì§€ ì…ë ¥ ê°€ëŠ¥

#### ë””ì§€í„¸ ìƒí’ˆ (ì¿ í°, í¬ì¸íŠ¸ ë“±)

1. **ë³„ë„ í…Œì´ë¸” ìƒì„±** (`event_reward_contacts`)
2. **ëª…í™•í•œ ëª©ì ìœ¼ë¡œ ë™ì˜ ë°›ê¸°** (ì´ë²¤íŠ¸ ìƒí’ˆ ì „ë‹¬ìš©)
3. **ì¸ì¦ ì ˆì°¨ ì¶”ê°€** (ì´ë©”ì¼/SMS ì¸ì¦)
4. **í† ìŠ¤ ì´ë©”ì¼ì€ ì°¸ê³ ìš©ìœ¼ë¡œë§Œ í™œìš©** (ë¯¸ë¦¬ ì±„ì›Œë†“ê¸°)
5. **ê°ì‚¬ ë¡œê·¸ ì €ì¥** (IP, User-Agent, ë™ì˜ ì‹œê°)
6. **ë³´ìœ  ê¸°ê°„ ëª…ì‹œ** (ì „ë‹¬ ì™„ë£Œ í›„ 30ì¼)

### âŒ DON'T (ë¹„ê¶Œì¥)

1. âŒ í† ìŠ¤ ë¡œê·¸ì¸ ì •ë³´ë¥¼ DBì— ì €ì¥í•˜ì—¬ ìƒí’ˆ ë°°ì†¡ì— ì‚¬ìš©
2. âŒ `user_profiles` í…Œì´ë¸”ì— ìƒí’ˆ ìˆ˜ë ¹ ì •ë³´ ì €ì¥
3. âŒ ì¸ì¦ ì—†ì´ ì´ë©”ì¼/ì „í™”ë²ˆí˜¸ ìˆ˜ì§‘ (ë””ì§€í„¸ ìƒí’ˆì˜ ê²½ìš°)
4. âŒ ëª©ì  ì™¸ ì‚¬ìš© ë™ì˜ ì—†ì´ í™œìš©

### ğŸ“‹ ìƒí’ˆ ìœ í˜•ë³„ ìµœì¢… ì„ íƒ ê°€ì´ë“œ

| ìƒí’ˆ ìœ í˜• | ê¶Œì¥ ë°©ì‹ | ë¬¸ì„œ ì°¸ê³  |
|-----------|-----------|-----------|
| ìŠ¤ë§ˆíŠ¸ ì›Œì¹˜, ê°€ì „ì œí’ˆ ë“± | ë§í¬ ë°œì†¡ ë°©ì‹ â­ | [PHYSICAL_REWARD_DELIVERY_STRATEGY.md](PHYSICAL_REWARD_DELIVERY_STRATEGY.md) |
| ì¿ í°, í¬ì¸íŠ¸, ë””ì§€í„¸ ì½”ë“œ | ë³„ë„ í…Œì´ë¸” ìˆ˜ì§‘ | ë³¸ ë¬¸ì„œ 3.2ì ˆ ì°¸ê³  |

---

## 9. ì°¸ê³  ìë£Œ

- [ê°œì¸ì •ë³´ ë³´í˜¸ë²•](https://www.law.go.kr/)
- [ê°œì¸ì •ë³´ ë³´í˜¸ìœ„ì›íšŒ ê°€ì´ë“œë¼ì¸](https://www.pipc.go.kr/)
- [í† ìŠ¤ ë¡œê·¸ì¸ ê°œë°œ ê°€ì´ë“œ](https://developers-apps-in-toss.toss.im/login/develop.md)

---

**ë¬¸ì„œ ë²„ì „:** 1.0
**ìµœì¢… ìˆ˜ì •:** 2026-01-04
