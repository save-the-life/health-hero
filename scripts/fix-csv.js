const fs = require('fs');
const path = require('path');

const csvPath = path.join(__dirname, '..', 'quizzes_1000_merged.csv');
let content = fs.readFileSync(csvPath, 'utf8');

// 문제가 있는 패턴들을 수정 (선택지 내의 쉼표를 ·로 대체)
const replacements = [
  // 정신건강 관련
  ['우울증, 치매', '우울증·치매'],
  ['땀, 떨림, 의식 저하', '땀·떨림·의식 저하'],
  ['피로, 체중 변화, 목 부종', '피로·체중 변화·목 부종'],

  // 예방법 관련
  ['금연, 운동, 건강한 식단', '금연·운동·건강한 식단'],
  ['저염식과 규칙적인 운동', '저염식·규칙적인 운동'],
  ['칼슘과 비타민 D 섭취, 체중부하 운동', '칼슘·비타민 D 섭취·체중부하 운동'],
  ['절주와 체중 관리', '절주·체중 관리'],
  ['식이섬유와 수분 섭취, 규칙적 운동', '식이섬유·수분 섭취·규칙적 운동'],
  ['식이섬유 섭취와 정기 검진', '식이섬유 섭취·정기 검진'],
  ['충분한 수면과 균형 잡힌 생활', '충분한 수면·균형 잡힌 생활'],

  // 검사/증상 관련
  ['AST, ALT', 'AST·ALT'],
  ['TSH, T3, T4', 'TSH·T3·T4'],
  ['당뇨, 신장 질환, 요로 감염', '당뇨·신장 질환·요로 감염'],
  ['기침, 재채기', '기침·재채기'],
  ['얼굴 처짐, 팔 마비, 언어 장애', '얼굴 처짐·팔 마비·언어 장애'],
  ['Face, Arm, Speech, Time', 'Face·Arm·Speech·Time'],
  ['FAST: Face, Arm, Speech, Time', 'FAST: Face·Arm·Speech·Time'],
  ['고혈압, 당뇨, 흡연, 고지혈증', '고혈압·당뇨·흡연·고지혈증'],

  // 기타
  ['0~5도(냉장), -18도 이하(냉동)', '0~5도(냉장)·-18도 이하(냉동)'],
  ['폐와 심장 이상', '폐·심장 이상'],
  ['철분이 풍부한 음식(고기, 시금치 등)', '철분이 풍부한 음식(고기·시금치 등)'],
  ['호흡곤란, 두드러기, 혈압 저하, 의식 저하', '호흡곤란·두드러기·혈압 저하·의식 저하'],
  ['정신적, 신체적 건강', '정신적·신체적 건강'],
  ['간, 담낭, 췌장, 신장', '간·담낭·췌장·신장'],
  ['폐렴, 결핵, 심장비대', '폐렴·결핵·심장비대'],
  ['부정맥, 심근경색', '부정맥·심근경색'],
  ['두부, 멸치, 채소', '두부·멸치·채소'],
  ['독서, 퍼즐, 사회 활동', '독서·퍼즐·사회 활동'],
  ['규칙적 운동, 사회 활동, 두뇌 훈련, 건강 관리', '규칙적 운동·사회 활동·두뇌 훈련·건강 관리'],
  ['충분한 수면, 균형 잡힌 식사, 스트레스 관리', '충분한 수면·균형 잡힌 식사·스트레스 관리'],
  ['금연, 절주, 균형 잡힌 식단, 운동, 검진', '금연·절주·균형 잡힌 식단·운동·검진'],
  ['금연, 운동, 건강한 식단, 스트레스 관리', '금연·운동·건강한 식단·스트레스 관리'],
  ['탄수화물, 단백질, 지방, 비타민, 미네랄', '탄수화물·단백질·지방·비타민·미네랄'],
  ['고기, 시금치, 콩', '고기·시금치·콩'],
  ['Rest, Ice, Compression, Elevation', 'Rest·Ice·Compression·Elevation'],
  ['동전, 단추', '동전·단추'],
  ['남성 2잔, 여성 1잔', '남성 2잔·여성 1잔'],
  ['과일, 견과류', '과일·견과류'],
];

let fixCount = 0;
replacements.forEach(([from, to]) => {
  const regex = new RegExp(from.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
  const matches = content.match(regex);
  if (matches) {
    fixCount += matches.length;
    content = content.replace(regex, to);
  }
});

// 저장
fs.writeFileSync(csvPath, content, 'utf8');
console.log(`✅ 수정 완료: ${fixCount}개의 쉼표가 ·로 대체됨`);
